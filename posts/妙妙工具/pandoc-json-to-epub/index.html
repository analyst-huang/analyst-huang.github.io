<!doctype html><html lang=en dir=auto data-theme=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>用 Pandoc 将 Pandoc AST JSON 生成 EPUB（稳定可复现工作流） | Blog</title><meta name=keywords content><meta name=description content="背景
当你的内容已经被整理成 Pandoc AST JSON（即 Pandoc 的抽象语法树 JSON：顶层包含 pandoc-api-version / meta / blocks），Pandoc 可以直接把它转换成 EPUB，而不需要再走「拼 Markdown」的路径。
这条路线的优势是：

结构严格：章节、段落、目录都由 AST 明确表达
自动化友好：适合爬虫/批处理/流水线
输出稳定：避免 “把 \n 塞进字符串却不换行” 等语义问题


本文默认你的 JSON 已经是 Pandoc AST JSON。如果你的 JSON 是业务结构（例如 chapters/paras），需要先转换为 Pandoc AST，再继续。


0. 快速自检：你的 JSON 是否是 Pandoc AST
打开 JSON 文件，顶层应类似：

pandoc-api-version: 版本数组
meta: 元数据
blocks: 块级节点数组（Header / Para 等）

也可以用 Pandoc 做一次“反向转换”来验证能否被解析：
pandoc -f json book.json -t markdown -o check.md
如果能生成合理的 Markdown（章节、段落结构正确），基本就没问题。

1. 最小命令：JSON → EPUB
pandoc -f json -t epub book.json -o book.epub
参数说明："><meta name=author content><link rel=canonical href=https://analyst-huang.github.io/posts/%E5%A6%99%E5%A6%99%E5%B7%A5%E5%85%B7/pandoc-json-to-epub/><link crossorigin=anonymous href=/assets/css/stylesheet.343cc480b9ffc8f04ccbe5e968ad674880cab773ec19905e93033065c1e7a804.css integrity="sha256-NDzEgLn/yPBMy+XpaK1nSIDKt3PsGZBekwMwZcHnqAQ=" rel="preload stylesheet" as=style><link rel=icon href=https://analyst-huang.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://analyst-huang.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://analyst-huang.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://analyst-huang.github.io/apple-touch-icon.png><link rel=mask-icon href=https://analyst-huang.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://analyst-huang.github.io/posts/%E5%A6%99%E5%A6%99%E5%B7%A5%E5%85%B7/pandoc-json-to-epub/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51);color-scheme:dark}.list{background:var(--theme)}.toc{background:var(--entry)}}@media(prefers-color-scheme:light){.list::-webkit-scrollbar-thumb{border-color:var(--code-bg)}}</style></noscript><script>localStorage.getItem("pref-theme")==="dark"?document.querySelector("html").dataset.theme="dark":localStorage.getItem("pref-theme")==="light"?document.querySelector("html").dataset.theme="light":window.matchMedia("(prefers-color-scheme: dark)").matches?document.querySelector("html").dataset.theme="dark":document.querySelector("html").dataset.theme="light"</script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\\\(",right:"\\\\)",display:!1},{left:"\\\\[",right:"\\\\]",display:!0}]})})</script><meta property="og:url" content="https://analyst-huang.github.io/posts/%E5%A6%99%E5%A6%99%E5%B7%A5%E5%85%B7/pandoc-json-to-epub/"><meta property="og:site_name" content="Blog"><meta property="og:title" content="用 Pandoc 将 Pandoc AST JSON 生成 EPUB（稳定可复现工作流）"><meta property="og:description" content="背景 当你的内容已经被整理成 Pandoc AST JSON（即 Pandoc 的抽象语法树 JSON：顶层包含 pandoc-api-version / meta / blocks），Pandoc 可以直接把它转换成 EPUB，而不需要再走「拼 Markdown」的路径。
这条路线的优势是：
结构严格：章节、段落、目录都由 AST 明确表达 自动化友好：适合爬虫/批处理/流水线 输出稳定：避免 “把 \n 塞进字符串却不换行” 等语义问题 本文默认你的 JSON 已经是 Pandoc AST JSON。如果你的 JSON 是业务结构（例如 chapters/paras），需要先转换为 Pandoc AST，再继续。
0. 快速自检：你的 JSON 是否是 Pandoc AST 打开 JSON 文件，顶层应类似：
pandoc-api-version: 版本数组 meta: 元数据 blocks: 块级节点数组（Header / Para 等） 也可以用 Pandoc 做一次“反向转换”来验证能否被解析：
pandoc -f json book.json -t markdown -o check.md 如果能生成合理的 Markdown（章节、段落结构正确），基本就没问题。
1. 最小命令：JSON → EPUB pandoc -f json -t epub book.json -o book.epub 参数说明："><meta property="og:locale" content="zh-cn"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2026-01-26T23:00:00-08:00"><meta property="article:modified_time" content="2026-01-26T23:00:00-08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="用 Pandoc 将 Pandoc AST JSON 生成 EPUB（稳定可复现工作流）"><meta name=twitter:description content="背景
当你的内容已经被整理成 Pandoc AST JSON（即 Pandoc 的抽象语法树 JSON：顶层包含 pandoc-api-version / meta / blocks），Pandoc 可以直接把它转换成 EPUB，而不需要再走「拼 Markdown」的路径。
这条路线的优势是：

结构严格：章节、段落、目录都由 AST 明确表达
自动化友好：适合爬虫/批处理/流水线
输出稳定：避免 “把 \n 塞进字符串却不换行” 等语义问题


本文默认你的 JSON 已经是 Pandoc AST JSON。如果你的 JSON 是业务结构（例如 chapters/paras），需要先转换为 Pandoc AST，再继续。


0. 快速自检：你的 JSON 是否是 Pandoc AST
打开 JSON 文件，顶层应类似：

pandoc-api-version: 版本数组
meta: 元数据
blocks: 块级节点数组（Header / Para 等）

也可以用 Pandoc 做一次“反向转换”来验证能否被解析：
pandoc -f json book.json -t markdown -o check.md
如果能生成合理的 Markdown（章节、段落结构正确），基本就没问题。

1. 最小命令：JSON → EPUB
pandoc -f json -t epub book.json -o book.epub
参数说明："><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://analyst-huang.github.io/posts/"},{"@type":"ListItem","position":3,"name":"用 Pandoc 将 Pandoc AST JSON 生成 EPUB（稳定可复现工作流）","item":"https://analyst-huang.github.io/posts/%E5%A6%99%E5%A6%99%E5%B7%A5%E5%85%B7/pandoc-json-to-epub/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"用 Pandoc 将 Pandoc AST JSON 生成 EPUB（稳定可复现工作流）","name":"用 Pandoc 将 Pandoc AST JSON 生成 EPUB（稳定可复现工作流）","description":"背景 当你的内容已经被整理成 Pandoc AST JSON（即 Pandoc 的抽象语法树 JSON：顶层包含 pandoc-api-version / meta / blocks），Pandoc 可以直接把它转换成 EPUB，而不需要再走「拼 Markdown」的路径。\n这条路线的优势是：\n结构严格：章节、段落、目录都由 AST 明确表达 自动化友好：适合爬虫/批处理/流水线 输出稳定：避免 “把 \\n 塞进字符串却不换行” 等语义问题 本文默认你的 JSON 已经是 Pandoc AST JSON。如果你的 JSON 是业务结构（例如 chapters/paras），需要先转换为 Pandoc AST，再继续。\n0. 快速自检：你的 JSON 是否是 Pandoc AST 打开 JSON 文件，顶层应类似：\npandoc-api-version: 版本数组 meta: 元数据 blocks: 块级节点数组（Header / Para 等） 也可以用 Pandoc 做一次“反向转换”来验证能否被解析：\npandoc -f json book.json -t markdown -o check.md 如果能生成合理的 Markdown（章节、段落结构正确），基本就没问题。\n1. 最小命令：JSON → EPUB pandoc -f json -t epub book.json -o book.epub 参数说明：\n","keywords":[],"articleBody":"背景 当你的内容已经被整理成 Pandoc AST JSON（即 Pandoc 的抽象语法树 JSON：顶层包含 pandoc-api-version / meta / blocks），Pandoc 可以直接把它转换成 EPUB，而不需要再走「拼 Markdown」的路径。\n这条路线的优势是：\n结构严格：章节、段落、目录都由 AST 明确表达 自动化友好：适合爬虫/批处理/流水线 输出稳定：避免 “把 \\n 塞进字符串却不换行” 等语义问题 本文默认你的 JSON 已经是 Pandoc AST JSON。如果你的 JSON 是业务结构（例如 chapters/paras），需要先转换为 Pandoc AST，再继续。\n0. 快速自检：你的 JSON 是否是 Pandoc AST 打开 JSON 文件，顶层应类似：\npandoc-api-version: 版本数组 meta: 元数据 blocks: 块级节点数组（Header / Para 等） 也可以用 Pandoc 做一次“反向转换”来验证能否被解析：\npandoc -f json book.json -t markdown -o check.md 如果能生成合理的 Markdown（章节、段落结构正确），基本就没问题。\n1. 最小命令：JSON → EPUB pandoc -f json -t epub book.json -o book.epub 参数说明：\n-f json：输入格式为 Pandoc AST JSON -t epub：输出为 EPUB -o book.epub：输出文件名 2. 生成目录（TOC） pandoc -f json -t epub book.json -o book.epub --toc --toc-depth=2 --toc：生成目录 --toc-depth=2：目录深度（通常 1=章节，2=章节+小节） 目录层级来源于 Header 的 level：1/2/3...。建议不要跳级（例如直接从 1 到 3）。\n3. 元数据（书名/作者/语言） 你有两种方式设置元数据：\n3.1 在命令行覆盖/补充 pandoc -f json -t epub book.json -o book.epub --metadata title=\"书名\" --metadata author=\"作者\" --metadata language=\"zh-CN\" 3.2 在 JSON 的 meta 中写入 例如书名：\n\"meta\": { \"title\": { \"t\": \"MetaString\", \"c\": \"书名\" } } 实务上更推荐：meta 写在 JSON 里（可版本控制），命令行只负责构建。\n4. 封面与样式（CSS） 4.1 添加封面 pandoc -f json -t epub book.json -o book.epub --epub-cover-image=cover.jpg 4.2 自定义排版（尤其是中文缩进） 写一个 epub.css（示例）：\np { text-indent: 2em; line-height: 1.7; margin: 0 0 0.9em 0; } 然后：\npandoc -f json -t epub book.json -o book.epub --css=epub.css --toc 重要提示：不要靠在字符串里塞空格实现缩进。HTML/EPUB 会折叠空格，缩进应交给 CSS。\n5. 调试与验收：先转成 HTML/Markdown 看结构 当你怀疑 EPUB 显示异常时，先把同一份 AST 转成更易读的格式：\npandoc -f json book.json -t html -o check.html pandoc -f json book.json -t markdown -o check.md 建议重点检查：\n每个段落是否对应一个 Para block 章节是否用 Header block（level 是否合理） 是否把整段文本塞进一个 Str（这会导致换行被压缩） 6. 常见坑：为什么 \\n\\n 不会自动变成段落 在 Pandoc AST 里：\n段落分隔是结构：多个 Para block Str 是“纯文本 token”，其内部的 \\n 不会被当作段落语义解析 正确做法：\n按 \\n\\n（或你定义的段落规则）拆分文本 为每一段生成一个 Para block 如果只是段内换行，可用 inline 节点 LineBreak（但小说正文通常不建议滥用）。\n7. 一个可复现的构建命令（建议固化到脚本） Windows PowerShell 示例 pandoc -f json -t epub .\\book.json -o .\\book.epub ` --toc --toc-depth=2 ` --metadata language=\"zh-CN\" ` --css .\\epub.css ` --epub-cover-image .\\cover.jpg Bash 示例 pandoc -f json -t epub ./book.json -o ./book.epub \\ --toc --toc-depth=2 \\ --metadata language=zh-CN \\ --css ./epub.css \\ --epub-cover-image ./cover.jpg 8. 输出校验（可选但推荐） 用 Calibre 打开预览（阅读器兼容性较好） 需要严格校验可用 epubcheck（常见于出版流程） 总结 如果你已经有 Pandoc AST JSON：\npandoc -f json -t epub book.json -o book.epub --toc 自动目录 --css 做中文排版（缩进/行距/段落间距） 用 -t html/-t markdown 先做结构验收，避免在 EPUB 里盲查问题 这套流程适合爬虫与批量生成电子书：结构可控、输出稳定、可复现。\n","wordCount":"336","inLanguage":"en","datePublished":"2026-01-26T23:00:00-08:00","dateModified":"2026-01-26T23:00:00-08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://analyst-huang.github.io/posts/%E5%A6%99%E5%A6%99%E5%B7%A5%E5%85%B7/pandoc-json-to-epub/"},"publisher":{"@type":"Organization","name":"Blog","logo":{"@type":"ImageObject","url":"https://analyst-huang.github.io/favicon.ico"}}}</script></head><body id=top><header class=header><nav class=nav><div class=logo><a href=https://analyst-huang.github.io/ accesskey=h title="Blog (Alt + H)">Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://analyst-huang.github.io/posts/ title=文章><span>文章</span></a></li><li><a href=https://analyst-huang.github.io/about/ title=关于><span>关于</span></a></li><li><a href=https://analyst-huang.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://analyst-huang.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://analyst-huang.github.io/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">用 Pandoc 将 Pandoc AST JSON 生成 EPUB（稳定可复现工作流）</h1><div class=post-meta><span title='2026-01-26 23:00:00 -0800 -0800'>January 26, 2026</span>&nbsp;·&nbsp;<span>2 min</span></div></header><div class=post-content><h1 id=背景>背景<a hidden class=anchor aria-hidden=true href=#背景>#</a></h1><p>当你的内容已经被整理成 <strong>Pandoc AST JSON</strong>（即 Pandoc 的抽象语法树 JSON：顶层包含 <code>pandoc-api-version / meta / blocks</code>），Pandoc 可以直接把它转换成 EPUB，而不需要再走「拼 Markdown」的路径。</p><p>这条路线的优势是：</p><ul><li>结构严格：章节、段落、目录都由 AST 明确表达</li><li>自动化友好：适合爬虫/批处理/流水线</li><li>输出稳定：避免 “把 <code>\n</code> 塞进字符串却不换行” 等语义问题</li></ul><blockquote><p>本文默认你的 JSON 已经是 <strong>Pandoc AST JSON</strong>。如果你的 JSON 是业务结构（例如 <code>chapters/paras</code>），需要先转换为 Pandoc AST，再继续。</p></blockquote><hr><h1 id=0-快速自检你的-json-是否是-pandoc-ast>0. 快速自检：你的 JSON 是否是 Pandoc AST<a hidden class=anchor aria-hidden=true href=#0-快速自检你的-json-是否是-pandoc-ast>#</a></h1><p>打开 JSON 文件，顶层应类似：</p><ul><li><code>pandoc-api-version</code>: 版本数组</li><li><code>meta</code>: 元数据</li><li><code>blocks</code>: 块级节点数组（<code>Header</code> / <code>Para</code> 等）</li></ul><p>也可以用 Pandoc 做一次“反向转换”来验证能否被解析：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>pandoc -f json book.json -t markdown -o check.md
</span></span></code></pre></div><p>如果能生成合理的 Markdown（章节、段落结构正确），基本就没问题。</p><hr><h1 id=1-最小命令json--epub>1. 最小命令：JSON → EPUB<a hidden class=anchor aria-hidden=true href=#1-最小命令json--epub>#</a></h1><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>pandoc -f json -t epub book.json -o book.epub
</span></span></code></pre></div><p>参数说明：</p><ul><li><code>-f json</code>：输入格式为 Pandoc AST JSON</li><li><code>-t epub</code>：输出为 EPUB</li><li><code>-o book.epub</code>：输出文件名</li></ul><hr><h1 id=2-生成目录toc>2. 生成目录（TOC）<a hidden class=anchor aria-hidden=true href=#2-生成目录toc>#</a></h1><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>pandoc -f json -t epub book.json -o book.epub --toc --toc-depth<span style=color:#f92672>=</span><span style=color:#ae81ff>2</span>
</span></span></code></pre></div><ul><li><code>--toc</code>：生成目录</li><li><code>--toc-depth=2</code>：目录深度（通常 <code>1</code>=章节，<code>2</code>=章节+小节）</li></ul><blockquote><p>目录层级来源于 <code>Header</code> 的 level：<code>1/2/3...</code>。建议不要跳级（例如直接从 1 到 3）。</p></blockquote><hr><h1 id=3-元数据书名作者语言>3. 元数据（书名/作者/语言）<a hidden class=anchor aria-hidden=true href=#3-元数据书名作者语言>#</a></h1><p>你有两种方式设置元数据：</p><h2 id=31-在命令行覆盖补充>3.1 在命令行覆盖/补充<a hidden class=anchor aria-hidden=true href=#31-在命令行覆盖补充>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>pandoc -f json -t epub book.json -o book.epub   --metadata title<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;书名&#34;</span>   --metadata author<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;作者&#34;</span>   --metadata language<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;zh-CN&#34;</span>
</span></span></code></pre></div><h2 id=32-在-json-的-meta-中写入>3.2 在 JSON 的 <code>meta</code> 中写入<a hidden class=anchor aria-hidden=true href=#32-在-json-的-meta-中写入>#</a></h2><p>例如书名：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#e6db74>&#34;meta&#34;</span><span style=color:#960050;background-color:#1e0010>:</span> {
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;title&#34;</span>: { <span style=color:#f92672>&#34;t&#34;</span>: <span style=color:#e6db74>&#34;MetaString&#34;</span>, <span style=color:#f92672>&#34;c&#34;</span>: <span style=color:#e6db74>&#34;书名&#34;</span> }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><blockquote><p>实务上更推荐：<strong>meta 写在 JSON 里</strong>（可版本控制），命令行只负责构建。</p></blockquote><hr><h1 id=4-封面与样式css>4. 封面与样式（CSS）<a hidden class=anchor aria-hidden=true href=#4-封面与样式css>#</a></h1><h2 id=41-添加封面>4.1 添加封面<a hidden class=anchor aria-hidden=true href=#41-添加封面>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>pandoc -f json -t epub book.json -o book.epub --epub-cover-image<span style=color:#f92672>=</span>cover.jpg
</span></span></code></pre></div><h2 id=42-自定义排版尤其是中文缩进>4.2 自定义排版（尤其是中文缩进）<a hidden class=anchor aria-hidden=true href=#42-自定义排版尤其是中文缩进>#</a></h2><p>写一个 <code>epub.css</code>（示例）：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-css data-lang=css><span style=display:flex><span><span style=color:#f92672>p</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>text-indent</span>: <span style=color:#ae81ff>2</span><span style=color:#66d9ef>em</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>line-height</span>: <span style=color:#ae81ff>1.7</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>margin</span>: <span style=color:#ae81ff>0</span> <span style=color:#ae81ff>0</span> <span style=color:#ae81ff>0.9</span><span style=color:#66d9ef>em</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>然后：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>pandoc -f json -t epub book.json -o book.epub --css<span style=color:#f92672>=</span>epub.css --toc
</span></span></code></pre></div><blockquote><p>重要提示：<strong>不要靠在字符串里塞空格实现缩进</strong>。HTML/EPUB 会折叠空格，缩进应交给 CSS。</p></blockquote><hr><h1 id=5-调试与验收先转成-htmlmarkdown-看结构>5. 调试与验收：先转成 HTML/Markdown 看结构<a hidden class=anchor aria-hidden=true href=#5-调试与验收先转成-htmlmarkdown-看结构>#</a></h1><p>当你怀疑 EPUB 显示异常时，先把同一份 AST 转成更易读的格式：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>pandoc -f json book.json -t html -o check.html
</span></span><span style=display:flex><span>pandoc -f json book.json -t markdown -o check.md
</span></span></code></pre></div><p>建议重点检查：</p><ul><li>每个段落是否对应一个 <code>Para</code> block</li><li>章节是否用 <code>Header</code> block（level 是否合理）</li><li>是否把整段文本塞进一个 <code>Str</code>（这会导致换行被压缩）</li></ul><hr><h1 id=6-常见坑为什么-nn-不会自动变成段落>6. 常见坑：为什么 <code>\n\n</code> 不会自动变成段落<a hidden class=anchor aria-hidden=true href=#6-常见坑为什么-nn-不会自动变成段落>#</a></h1><p>在 Pandoc AST 里：</p><ul><li><strong>段落分隔是结构</strong>：多个 <code>Para</code> block</li><li><code>Str</code> 是“纯文本 token”，其内部的 <code>\n</code> 不会被当作段落语义解析</li></ul><p>正确做法：</p><ul><li>按 <code>\n\n</code>（或你定义的段落规则）拆分文本</li><li>为每一段生成一个 <code>Para</code> block</li></ul><p>如果只是段内换行，可用 inline 节点 <code>LineBreak</code>（但小说正文通常不建议滥用）。</p><hr><h1 id=7-一个可复现的构建命令建议固化到脚本>7. 一个可复现的构建命令（建议固化到脚本）<a hidden class=anchor aria-hidden=true href=#7-一个可复现的构建命令建议固化到脚本>#</a></h1><h2 id=windows-powershell-示例>Windows PowerShell 示例<a hidden class=anchor aria-hidden=true href=#windows-powershell-示例>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-powershell data-lang=powershell><span style=display:flex><span>pandoc <span style=color:#f92672>-f</span> json -t epub .\book.json -o .\book.epub `
</span></span><span style=display:flex><span>  --toc --toc-depth=<span style=color:#ae81ff>2</span> `
</span></span><span style=display:flex><span>  --metadata language=<span style=color:#e6db74>&#34;zh-CN&#34;</span> `
</span></span><span style=display:flex><span>  --css .\epub.css `
</span></span><span style=display:flex><span>  --epub-cover-image .\cover.jpg
</span></span></code></pre></div><h2 id=bash-示例>Bash 示例<a hidden class=anchor aria-hidden=true href=#bash-示例>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>pandoc -f json -t epub ./book.json -o ./book.epub <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>  --toc --toc-depth<span style=color:#f92672>=</span><span style=color:#ae81ff>2</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>  --metadata language<span style=color:#f92672>=</span>zh-CN <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>  --css ./epub.css <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>  --epub-cover-image ./cover.jpg
</span></span></code></pre></div><hr><h1 id=8-输出校验可选但推荐>8. 输出校验（可选但推荐）<a hidden class=anchor aria-hidden=true href=#8-输出校验可选但推荐>#</a></h1><ul><li>用 Calibre 打开预览（阅读器兼容性较好）</li><li>需要严格校验可用 <code>epubcheck</code>（常见于出版流程）</li></ul><hr><h1 id=总结>总结<a hidden class=anchor aria-hidden=true href=#总结>#</a></h1><p>如果你已经有 <strong>Pandoc AST JSON</strong>：</p><ol><li><code>pandoc -f json -t epub book.json -o book.epub</code></li><li><code>--toc</code> 自动目录</li><li><code>--css</code> 做中文排版（缩进/行距/段落间距）</li><li>用 <code>-t html/-t markdown</code> 先做结构验收，避免在 EPUB 里盲查问题</li></ol><p>这套流程适合爬虫与批量生成电子书：结构可控、输出稳定、可复现。</p></div><footer class=post-footer><ul class=post-tags></ul></footer></article></main><footer class=footer><span>&copy; 2026 <a href=https://analyst-huang.github.io/>Blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");if(menu){const e=localStorage.getItem("menu-scroll-position");e&&(menu.scrollLeft=parseInt(e,10)),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}}document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{const e=document.querySelector("html");e.dataset.theme==="dark"?(e.dataset.theme="light",localStorage.setItem("pref-theme","light")):(e.dataset.theme="dark",localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>