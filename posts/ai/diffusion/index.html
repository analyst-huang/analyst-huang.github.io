<!doctype html><html lang=en dir=auto data-theme=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Diffusion | Blog</title><meta name=keywords content><meta name=description content="tæ­¥åŠ å™ªå¯ä»¥å†™æˆå¦‚ä¸‹å½¢å¼ï¼š

  
$x_t = \sqrt{\bar{\alpha}_t}\, x_0 + \sqrt{1 - \bar{\alpha}_t}\, \varepsilon,\quad \varepsilon \sim \mathcal{N}(0, I)$



å…¶ä¸­ï¼š

  
$\alpha_t = 1 - \beta_t,\quad \bar{\alpha}_t = \prod_{s=1}^{t} \alpha_s, \alpha_t \in [0,1] $



äºŒã€ä¸¥æ ¼æ¨å¯¼ï¼šç”¨è´å¶æ–¯å…¬å¼ï¼ˆforward åéªŒï¼‰
1) æ¦‚ç‡å›¾ç»“æ„ä¸è´å¶æ–¯å±•å¼€
ä»æ¦‚ç‡å›¾ï¼ˆforward é“¾ï¼‰ï¼š

  
$
x_0 \rightarrow x_{t-1} \rightarrow x_t
$



ç”±è´å¶æ–¯å…¬å¼ï¼š

  
$
q(x_{t-1}\mid x_t, x_0)
=
\frac{q(x_t\mid x_{t-1}, x_0)\,q(x_{t-1}\mid x_0)}{q(x_t\mid x_0)}.
$



ç”±äº forward è¿‡ç¨‹çš„é©¬å°”å¯å¤«æ€§ï¼š

  
$
q(x_t\mid x_{t-1}, x_0)=q(x_t\mid x_{t-1}),
$



å› æ­¤ï¼š

  
$
q(x_{t-1}\mid x_t, x_0)
=
\frac{q(x_t\mid x_{t-1})\,q(x_{t-1}\mid x_0)}{q(x_t\mid x_0)}.
$


"><meta name=author content><link rel=canonical href=https://analyst-huang.github.io/posts/ai/diffusion/><link crossorigin=anonymous href=/assets/css/stylesheet.343cc480b9ffc8f04ccbe5e968ad674880cab773ec19905e93033065c1e7a804.css integrity="sha256-NDzEgLn/yPBMy+XpaK1nSIDKt3PsGZBekwMwZcHnqAQ=" rel="preload stylesheet" as=style><link rel=icon href=https://analyst-huang.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://analyst-huang.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://analyst-huang.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://analyst-huang.github.io/apple-touch-icon.png><link rel=mask-icon href=https://analyst-huang.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://analyst-huang.github.io/posts/ai/diffusion/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51);color-scheme:dark}.list{background:var(--theme)}.toc{background:var(--entry)}}@media(prefers-color-scheme:light){.list::-webkit-scrollbar-thumb{border-color:var(--code-bg)}}</style></noscript><script>localStorage.getItem("pref-theme")==="dark"?document.querySelector("html").dataset.theme="dark":localStorage.getItem("pref-theme")==="light"?document.querySelector("html").dataset.theme="light":window.matchMedia("(prefers-color-scheme: dark)").matches?document.querySelector("html").dataset.theme="dark":document.querySelector("html").dataset.theme="light"</script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\\\(",right:"\\\\)",display:!1},{left:"\\\\[",right:"\\\\]",display:!0}]})})</script><meta property="og:url" content="https://analyst-huang.github.io/posts/ai/diffusion/"><meta property="og:site_name" content="Blog"><meta property="og:title" content="Diffusion"><meta property="og:description" content="tæ­¥åŠ å™ªå¯ä»¥å†™æˆå¦‚ä¸‹å½¢å¼ï¼š
$x_t = \sqrt{\bar{\alpha}_t}\, x_0 + \sqrt{1 - \bar{\alpha}_t}\, \varepsilon,\quad \varepsilon \sim \mathcal{N}(0, I)$ å…¶ä¸­ï¼š
$\alpha_t = 1 - \beta_t,\quad \bar{\alpha}_t = \prod_{s=1}^{t} \alpha_s, \alpha_t \in [0,1] $ äºŒã€ä¸¥æ ¼æ¨å¯¼ï¼šç”¨è´å¶æ–¯å…¬å¼ï¼ˆforward åéªŒï¼‰ 1) æ¦‚ç‡å›¾ç»“æ„ä¸è´å¶æ–¯å±•å¼€ ä»æ¦‚ç‡å›¾ï¼ˆforward é“¾ï¼‰ï¼š $ x_0 \rightarrow x_{t-1} \rightarrow x_t $ ç”±è´å¶æ–¯å…¬å¼ï¼š $ q(x_{t-1}\mid x_t, x_0) = \frac{q(x_t\mid x_{t-1}, x_0)\,q(x_{t-1}\mid x_0)}{q(x_t\mid x_0)}. $ ç”±äº forward è¿‡ç¨‹çš„é©¬å°”å¯å¤«æ€§ï¼š $ q(x_t\mid x_{t-1}, x_0)=q(x_t\mid x_{t-1}), $ å› æ­¤ï¼š $ q(x_{t-1}\mid x_t, x_0) = \frac{q(x_t\mid x_{t-1})\,q(x_{t-1}\mid x_0)}{q(x_t\mid x_0)}. $ "><meta property="og:locale" content="zh-cn"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2026-01-08T00:00:00+00:00"><meta property="article:modified_time" content="2026-01-08T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Diffusion"><meta name=twitter:description content="tæ­¥åŠ å™ªå¯ä»¥å†™æˆå¦‚ä¸‹å½¢å¼ï¼š

  
$x_t = \sqrt{\bar{\alpha}_t}\, x_0 + \sqrt{1 - \bar{\alpha}_t}\, \varepsilon,\quad \varepsilon \sim \mathcal{N}(0, I)$



å…¶ä¸­ï¼š

  
$\alpha_t = 1 - \beta_t,\quad \bar{\alpha}_t = \prod_{s=1}^{t} \alpha_s, \alpha_t \in [0,1] $



äºŒã€ä¸¥æ ¼æ¨å¯¼ï¼šç”¨è´å¶æ–¯å…¬å¼ï¼ˆforward åéªŒï¼‰
1) æ¦‚ç‡å›¾ç»“æ„ä¸è´å¶æ–¯å±•å¼€
ä»æ¦‚ç‡å›¾ï¼ˆforward é“¾ï¼‰ï¼š

  
$
x_0 \rightarrow x_{t-1} \rightarrow x_t
$



ç”±è´å¶æ–¯å…¬å¼ï¼š

  
$
q(x_{t-1}\mid x_t, x_0)
=
\frac{q(x_t\mid x_{t-1}, x_0)\,q(x_{t-1}\mid x_0)}{q(x_t\mid x_0)}.
$



ç”±äº forward è¿‡ç¨‹çš„é©¬å°”å¯å¤«æ€§ï¼š

  
$
q(x_t\mid x_{t-1}, x_0)=q(x_t\mid x_{t-1}),
$



å› æ­¤ï¼š

  
$
q(x_{t-1}\mid x_t, x_0)
=
\frac{q(x_t\mid x_{t-1})\,q(x_{t-1}\mid x_0)}{q(x_t\mid x_0)}.
$


"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://analyst-huang.github.io/posts/"},{"@type":"ListItem","position":2,"name":"AI","item":"https://analyst-huang.github.io/posts/ai/"},{"@type":"ListItem","position":3,"name":"Diffusion","item":"https://analyst-huang.github.io/posts/ai/diffusion/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Diffusion","name":"Diffusion","description":"tæ­¥åŠ å™ªå¯ä»¥å†™æˆå¦‚ä¸‹å½¢å¼ï¼š\n$x_t = \\sqrt{\\bar{\\alpha}_t}\\, x_0 + \\sqrt{1 - \\bar{\\alpha}_t}\\, \\varepsilon,\\quad \\varepsilon \\sim \\mathcal{N}(0, I)$ å…¶ä¸­ï¼š\n$\\alpha_t = 1 - \\beta_t,\\quad \\bar{\\alpha}_t = \\prod_{s=1}^{t} \\alpha_s, \\alpha_t \\in [0,1] $ äºŒã€ä¸¥æ ¼æ¨å¯¼ï¼šç”¨è´å¶æ–¯å…¬å¼ï¼ˆforward åéªŒï¼‰ 1) æ¦‚ç‡å›¾ç»“æ„ä¸è´å¶æ–¯å±•å¼€ ä»æ¦‚ç‡å›¾ï¼ˆforward é“¾ï¼‰ï¼š $ x_0 \\rightarrow x_{t-1} \\rightarrow x_t $ ç”±è´å¶æ–¯å…¬å¼ï¼š $ q(x_{t-1}\\mid x_t, x_0) = \\frac{q(x_t\\mid x_{t-1}, x_0)\\,q(x_{t-1}\\mid x_0)}{q(x_t\\mid x_0)}. $ ç”±äº forward è¿‡ç¨‹çš„é©¬å°”å¯å¤«æ€§ï¼š $ q(x_t\\mid x_{t-1}, x_0)=q(x_t\\mid x_{t-1}), $ å› æ­¤ï¼š $ q(x_{t-1}\\mid x_t, x_0) = \\frac{q(x_t\\mid x_{t-1})\\,q(x_{t-1}\\mid x_0)}{q(x_t\\mid x_0)}. $ ","keywords":[],"articleBody":"tæ­¥åŠ å™ªå¯ä»¥å†™æˆå¦‚ä¸‹å½¢å¼ï¼š\n$x_t = \\sqrt{\\bar{\\alpha}_t}\\, x_0 + \\sqrt{1 - \\bar{\\alpha}_t}\\, \\varepsilon,\\quad \\varepsilon \\sim \\mathcal{N}(0, I)$ å…¶ä¸­ï¼š\n$\\alpha_t = 1 - \\beta_t,\\quad \\bar{\\alpha}_t = \\prod_{s=1}^{t} \\alpha_s, \\alpha_t \\in [0,1] $ äºŒã€ä¸¥æ ¼æ¨å¯¼ï¼šç”¨è´å¶æ–¯å…¬å¼ï¼ˆforward åéªŒï¼‰ 1) æ¦‚ç‡å›¾ç»“æ„ä¸è´å¶æ–¯å±•å¼€ ä»æ¦‚ç‡å›¾ï¼ˆforward é“¾ï¼‰ï¼š $ x_0 \\rightarrow x_{t-1} \\rightarrow x_t $ ç”±è´å¶æ–¯å…¬å¼ï¼š $ q(x_{t-1}\\mid x_t, x_0) = \\frac{q(x_t\\mid x_{t-1}, x_0)\\,q(x_{t-1}\\mid x_0)}{q(x_t\\mid x_0)}. $ ç”±äº forward è¿‡ç¨‹çš„é©¬å°”å¯å¤«æ€§ï¼š $ q(x_t\\mid x_{t-1}, x_0)=q(x_t\\mid x_{t-1}), $ å› æ­¤ï¼š $ q(x_{t-1}\\mid x_t, x_0) = \\frac{q(x_t\\mid x_{t-1})\\,q(x_{t-1}\\mid x_0)}{q(x_t\\mid x_0)}. $ 2) ä¸‰ä¸ªåˆ†å¸ƒéƒ½æ˜¯å·²çŸ¥é«˜æ–¯ è®° $ \\alpha_t = 1-\\beta_t,\\qquad \\bar\\alpha_t=\\prod_{s=1}^t \\alpha_s. $ forward å•æ­¥ï¼š $ q(x_t\\mid x_{t-1})=\\mathcal N(\\sqrt{\\alpha_t}\\,x_{t-1},\\ \\beta_t I). $ forward è¾¹ç¼˜ï¼ˆé—­å¼ï¼‰ï¼š $ q(x_{t-1}\\mid x_0)=\\mathcal N(\\sqrt{\\bar\\alpha_{t-1}}\\,x_0,\\ (1-\\bar\\alpha_{t-1})I), $ $ q(x_t\\mid x_0)=\\mathcal N(\\sqrt{\\bar\\alpha_t}\\,x_0,\\ (1-\\bar\\alpha_t)I). $ äºæ˜¯ï¼š $ q(x_{t-1}\\mid x_t, x_0) \\propto q(x_t\\mid x_{t-1})\\,q(x_{t-1}\\mid x_0) $ æ˜¯â€œé«˜æ–¯ Ã— é«˜æ–¯â€çš„å½¢å¼ï¼Œå› æ­¤åéªŒä»ä¸ºé«˜æ–¯ï¼š $ q(x_{t-1}\\mid x_t, x_0) = \\mathcal N\\!\\big(\\mu_t(x_t,x_0),\\ \\tilde\\beta_t I\\big). $ 3) åéªŒå‡å€¼ä¸æ–¹å·®ï¼ˆDDPM ç»å…¸é—­å¼ï¼‰ åéªŒæ–¹å·®ï¼š $ \\tilde\\beta_t = \\frac{1-\\bar\\alpha_{t-1}}{1-\\bar\\alpha_t}\\,\\beta_t. $ åéªŒå‡å€¼ï¼š $ \\mu_t(x_t,x_0) = \\frac{\\sqrt{\\bar\\alpha_{t-1}}\\,\\beta_t}{1-\\bar\\alpha_t}\\,x_0 + \\frac{\\sqrt{\\alpha_t}\\,(1-\\bar\\alpha_{t-1})}{1-\\bar\\alpha_t}\\,x_t. $ 4) å°ç»“ æˆ‘ä»¬ä¸¥æ ¼åœ°ä»ï¼š $ q(x_{t-1}\\mid x_t,x_0) = \\frac{q(x_t\\mid x_{t-1})\\,q(x_{t-1}\\mid x_0)}{q(x_t\\mid x_0)} $ å‡ºå‘ï¼Œåˆ©ç”¨ forward é©¬å°”å¯å¤«æ€§ä¸é«˜æ–¯é—­åŒ…æ€§ï¼Œå¾—åˆ° $ q(x_{t-1}\\mid x_t,x_0)=\\mathcal N(\\mu_t,\\tilde\\beta_t I), $ å™ªå£°é¢„æµ‹ â‰¡ score matchingï¼ˆä¸¥æ ¼ç­‰ä»·ï¼‰ æˆ‘ä»¬çœ‹è®­ç»ƒç›®æ ‡ï¼ˆDDPM å¸¸ç”¨çš„ noise-prediction lossï¼‰ï¼š\n$ L(\\theta)=\\mathbb{E}_{x_0,\\varepsilon,t}\\,\\|\\varepsilon-\\varepsilon_\\theta(x_t,t)\\|_2^2, \\qquad x_t=\\sqrt{\\bar\\alpha_t}\\,x_0+\\sqrt{1-\\bar\\alpha_t}\\,\\varepsilon,\\ \\ \\varepsilon\\sim\\mathcal N(0,I). $ 1) æœ€ä¼˜è§£æ˜¯ä»€ä¹ˆï¼Ÿ å¯¹å›ºå®šçš„ $t$ ä¸è§‚æµ‹åˆ°çš„ $x_t$ï¼Œè¿™æ˜¯ä¸€ä¸ª**æ¡ä»¶å‡æ–¹è¯¯å·®ï¼ˆconditional MSEï¼‰**é—®é¢˜ã€‚ ä»¤ $f(x_t,t)=\\varepsilon_\\theta(x_t,t)$ã€‚åœ¨å¹³æ–¹æŸå¤±ä¸‹çš„å”¯ä¸€ï¼ˆå‡ ä¹å¤„å¤„ï¼‰æœ€ä¼˜è§£ä¸ºæ¡ä»¶æœŸæœ›ï¼š\n$ \\varepsilon_\\theta^\\star(x_t,t)=\\mathbb{E}[\\varepsilon\\mid x_t,t]. $ ï¼ˆç›´è§‚ï¼šå¹³æ–¹æŸå¤±çš„å›å½’æœ€ä¼˜é¢„æµ‹ = æ¡ä»¶å‡å€¼ã€‚ï¼‰\n2) ä¸¥æ ¼æ¨å‡ºï¼š$\\mathbb{E}[\\varepsilon\\mid x_t]$ ä¸ score çš„å…³ç³» ç”±ï¼ˆVincent 2011 / Tweedie å…¬å¼çš„å½¢å¼ï¼‰ï¼š\n$ \\boxed{ \\mathbb{E}[\\varepsilon\\mid x_t] = -\\sqrt{1-\\bar\\alpha_t}\\ \\nabla_{x_t}\\log p_t(x_t) } $ 3) æŠŠå®ƒå†™æˆ â€œå™ªå£°é¢„æµ‹ â†” scoreâ€ çš„ç­‰å¼ å› ä¸ºè®­ç»ƒä½¿å¾— $\\varepsilon_\\theta(x_t,t)\\approx \\mathbb{E}[\\varepsilon\\mid x_t]$ï¼Œäºæ˜¯\n$ \\boxed{ s_\\theta(x_t,t)\\ \\approx\\ \\nabla_{x_t}\\log p_t(x_t) = -\\frac{1}{\\sqrt{1-\\bar\\alpha_t}}\\ \\varepsilon_\\theta(x_t,t) } $ ä¹Ÿå³\n$ \\boxed{ \\varepsilon_\\theta(x_t,t)\\ \\approx\\ -\\sqrt{1-\\bar\\alpha_t}\\ s_\\theta(x_t,t) } $ 5) ä¸€å¥è¯ç›´è§‰ noise-prediction å›å½’åˆ° $\\mathbb{E}[\\varepsilon\\mid x_t]$ ç”±äºé«˜æ–¯å·ç§¯çš„è§£ææ€§è´¨ï¼Œè¿™ä¸ªæ¡ä»¶å‡å€¼ç­‰ä»·äºè¾¹ç¼˜å¯†åº¦ $p_t$ çš„ scoreï¼ˆå·®ä¸€ä¸ªç¡®å®šç³»æ•°ï¼‰ æ‰€ä»¥ â€œé¢„æµ‹å™ªå£°â€ å’Œ â€œscore matchingâ€ åœ¨è¿™é‡Œæ˜¯ä¸¥æ ¼åŒä¸€ä»¶äº‹ï¼ˆåªæ˜¯å‚æ•°åŒ–å½¢å¼ä¸åŒï¼‰ æœ€å¸¸ç”¨çš„ DDPM é‡‡æ ·å†™æ³•æ˜¯ï¼š\n$ \\sigma_t^2 = \\tilde{\\beta}_t \\;=\\; \\frac{1 - \\bar{\\alpha}_{t-1}}{1 - \\bar{\\alpha}_t}\\,\\beta_t $ , $ x_{t-1} = \\sqrt{\\frac{1}{\\alpha_t}} \\Big( x_t - \\frac{\\beta_t}{\\sqrt{1-\\bar{\\alpha}_t}} \\, \\varepsilon_\\theta(x_t, t) \\Big) + \\sigma_t z, \\quad z \\sim \\mathcal{N}(0, I) $ 3) ç”¨ score æ¥å†™åŒä¸€æ¡å…¬å¼ï¼ˆæ›´ç›´è§‚ï¼‰ æŠŠä¸Šé¢ç¬¬ (1) æ¡ä»£è¿›å»ï¼Œä½ ä¼šçœ‹åˆ°åå‘ä¸€æ­¥å¤§è‡´å°±æ˜¯ï¼š\n$ x_{t-1} \\;\\approx\\; \\underbrace{\\sqrt{\\frac{1}{\\alpha_t}} x_t}_{\\text{çº¿æ€§â€œå»è¡°å‡â€}} \\;+\\; \\underbrace{\\frac{\\beta_t}{\\alpha_t}\\, s_\\theta(x_t, t)}_{\\text{æ²¿ score å¾€é«˜æ¦‚ç‡åŒºæ¨}} \\;+\\; \\underbrace{\\sigma_t z}_{\\text{éšæœºæ€§ï¼ˆä¿ç•™å¤šè§£/å¤šæ¨¡æ€ï¼‰}}, \\quad z \\sim \\mathcal{N}(0, I) $ è¿™å°±æ˜¯ä½ æƒ³è¦çš„ç›´è§‰æŠŠæ¡ï¼š\nscore é¡¹ï¼šå‘Šè¯‰ä½ å¾€å“ªé‡Œèµ°æ›´åƒæ•°æ®ï¼ˆå¾€é«˜å¯†åº¦åŒºæ¨ï¼‰ éšæœºé¡¹ï¼šä¿è¯ä½ ä¸æ˜¯â€œçˆ¬å±±çˆ¬åˆ°æŸä¸ªå³°å°±å¡Œç¼©â€ï¼Œè€Œæ˜¯èƒ½è¦†ç›–åˆ†å¸ƒçš„ä¸åŒæ¨¡å¼ çº¿æ€§é¡¹ï¼šå¯¹åº”æ­£å‘é‡Œé‚£ä¸€ç‚¹ç‚¹ç¼©æ”¾/è¡°å‡çš„é€†æ“ä½œ ä¸€ã€ä¸€æ­¥å»å™ªï¼šä» $x_t$ å¾—åˆ°â€œå½“å‰è®¤ä¸ºçš„ clean sampleâ€ ä½ ç°åœ¨å·²ç»çŸ¥é“ç½‘ç»œåœ¨é¢„æµ‹å™ªå£°ï¼š\n$ \\varepsilon_\\theta(x_t, t) $ æ ‡å‡†çš„ä¸€æ­¥å»å™ªå…¬å¼å°±æ˜¯ç›´æ¥æŠŠå™ªå£°â€œå‡æ‰â€ï¼š\n$ \\hat{x}_0(x_t) = \\frac{1}{\\sqrt{\\bar{\\alpha}_t}} \\left( x_t - \\sqrt{1 - \\bar{\\alpha}_t}\\; \\varepsilon_\\theta(x_t, t) \\right) $ ç›´è§‰ç†è§£ï¼š\n$ x_t $ï¼šç°åœ¨è¿™ä¸ªå¸¦å™ªçš„æ ·æœ¬ $ \\varepsilon_\\theta $ï¼šæ¨¡å‹è®¤ä¸ºâ€œè¿™é‡Œé¢æœ‰å¤šå°‘æ˜¯å™ªå£°â€ $ \\hat{x}_0 $ï¼šåœ¨ç¬¬ $t$ æ­¥ï¼Œæ¨¡å‹å¿ƒä¸­â€œæœ€å¯èƒ½çš„å¹²å‡€æ ·æœ¬â€ é‡è¦å¼ºè°ƒï¼ˆé˜²æ­¢è¯¯è§£ï¼‰ï¼š\n$ \\hat{x}_0 $ ä¸æ˜¯æœ€ç»ˆç”Ÿæˆç»“æœï¼Œ\nå®ƒåªæ˜¯å½“å‰è¿™ä¸€æ­¥çš„â€œä¸´æ—¶ clean è§£é‡Šâ€ã€‚\näºŒã€Guidance çš„æ ¸å¿ƒæ€æƒ³ï¼ˆä¸€å¥è¯ç‰ˆï¼‰ ç°åœ¨å‡è®¾ä½ æœ‰ä¸€ä¸ªç›®æ ‡å‡½æ•°ï¼ˆæˆ–æŸå¤±ï¼‰ï¼š\n$ L(x_0) \\quad \\text{æˆ–} \\quad R(x_0) $ ä¾‹å¦‚ï¼š\nå’Œç›®æ ‡å›¾åƒçš„è·ç¦» æ˜¯å¦æ»¡è¶³æŸä¸ªçº¦æŸ è½¨è¿¹ reward classifier çš„ log-prob Guidance çš„æ€æƒ³åªæœ‰ä¸€å¥è¯ï¼š\næ—¢ç„¶æˆ‘å·²ç»èƒ½åœ¨æ¯ä¸€æ­¥å¾—åˆ°ä¸€ä¸ª $ \\hat{x}_0 $ï¼Œ\né‚£æˆ‘å°±å¯ä»¥åœ¨â€œé‡‡æ ·è¿‡ç¨‹ä¸­â€\nå¯¹è¿™ä¸ª $ \\hat{x}_0 $ æ–½åŠ æ¢¯åº¦ä¿®æ­£ã€‚\nä¸‰ã€æ¢¯åº¦æ˜¯æ€ä¹ˆçœŸæ­£â€œè¿› sample è¿‡ç¨‹â€çš„ï¼Ÿ è¿™æ˜¯å…³é”®éƒ¨åˆ†ï¼Œåˆ†ä¸‰æ­¥ã€‚\n1ï¸âƒ£ å…ˆåœ¨ clean space é‡Œç®—æ¢¯åº¦ å…ˆåœ¨å¹²å‡€ç©ºé—´è®¡ç®—æ¢¯åº¦ï¼š\n$ g = \\nabla_{\\hat{x}_0}\\, \\big( - L(\\hat{x}_0) \\big) $ å¦‚æœæ˜¯ rewardï¼Œåˆ™æ˜¯ï¼š\n$ \\nabla_{\\hat{x}_0}\\, R(\\hat{x}_0) $ ç›´è§‰ï¼š\nè¿™ä¸ªæ¢¯åº¦å‘Šè¯‰ä½ ï¼š\nå¦‚æœæˆ‘æ˜¯ä¸€ä¸ªå¹²å‡€æ ·æœ¬ï¼Œå¾€å“ªé‡ŒåŠ¨èƒ½è®© loss å˜å° / reward å˜å¤§ã€‚\n2ï¸âƒ£ æŠŠæ¢¯åº¦â€œä¼ å›â€åˆ°å½“å‰å™ªå£°å±‚ å…³é”®å…³ç³»æ˜¯ï¼š\n$ \\hat{x}_0 = \\frac{1}{\\sqrt{\\bar{\\alpha}_t}} x_t - \\frac{\\sqrt{1-\\bar{\\alpha}_t}}{\\sqrt{\\bar{\\alpha}_t}} \\varepsilon_\\theta(x_t, t) $ å¯¹ $ x_t $ æ±‚å¯¼ï¼š\n$ \\frac{\\partial \\hat{x}_0}{\\partial x_t} = \\frac{1}{\\sqrt{\\bar{\\alpha}_t}} I $ äºæ˜¯æ¢¯åº¦å›ä¼ éå¸¸ç®€å•ï¼š\n$ \\nabla_{x_t}\\, \\big( - L(\\hat{x}_0) \\big) = \\frac{1}{\\sqrt{\\bar{\\alpha}_t}} \\nabla_{\\hat{x}_0}\\, \\big( - L(\\hat{x}_0) \\big) $ è¿™ä¸€æ­¥æœ¬è´¨ä¸Šæ˜¯åœ¨åšï¼š\næŠŠ clean-space çš„åå¥½ï¼Œçº¿æ€§æ˜ å°„å›å½“å‰å™ªå£°å±‚ã€‚\n3ï¸âƒ£ æŠŠ guidance æ¢¯åº¦åŠ è¿›åå‘é‡‡æ · æ ‡å‡†åå‘é‡‡æ ·ï¼ˆscore å½¢å¼ï¼Œå¿½ç•¥å¸¸æ•°ç»†èŠ‚ï¼‰ï¼š\n$ x_{t-1} \\approx \\frac{1}{\\alpha_t} x_t + \\frac{\\beta_t}{\\alpha_t} \\, s_\\theta(x_t, t) + \\sigma_t z $ å…¶ä¸­ï¼š\n$ s_\\theta(x_t, t) = \\nabla_{x_t} \\log p(x_t) $ åŠ å…¥ guidance åï¼š\n$ x_{t-1} \\approx \\frac{1}{\\alpha_t} x_t + \\frac{\\beta_t}{\\alpha_t} \\left( s_\\theta(x_t, t) + \\lambda \\, \\nabla_{x_t} ( - L(\\hat{x}_0) ) \\right) + \\sigma_t z $ å…¶ä¸­ï¼š\n$ \\lambda $ï¼šguidance strengthï¼ˆä¸»è¦è°ƒè¿™ä¸ªï¼‰ è§£é‡Šï¼š\nåŸæœ¬çš„ score é¡¹ï¼š\nâ†’ â€œåƒæ•°æ®åˆ†å¸ƒçš„æ–¹å‘â€ æ–°åŠ çš„ guidance æ¢¯åº¦ï¼š\nâ†’ â€œæ›´ç¬¦åˆä»»åŠ¡ç›®æ ‡çš„æ–¹å‘â€ é‡‡æ ·æ—¶ä¸¤è‚¡åŠ›ä¸€èµ·æ‹‰ç€æ ·æœ¬å¾€å‰èµ°ã€‚\nä¸€å¥è¯æ€»ç›´è§‰æ€»ç»“ æ¨¡å‹å‘Šè¯‰ä½ ï¼šç°åœ¨è¿™ä¸ª $x_t$ æœ€å¯èƒ½æ¥è‡ªå“ªä¸ª $\\hat{x}_0$ ä½ åœ¨ $\\hat{x}_0$ ä¸Šè®¡ç®—ä»»åŠ¡æ¢¯åº¦ é€šè¿‡çº¿æ€§å…³ç³»æŠŠæ¢¯åº¦ä¼ å› $x_t$ åœ¨åå‘æ‰©æ•£æ—¶æŠŠè¿™ä¸ªæ–¹å‘åŠ è¿› drift æ‰€ä»¥ guidance ä¸æ˜¯æ”¹è®­ç»ƒç›®æ ‡ï¼Œ\nè€Œæ˜¯åœ¨é‡‡æ · ODE / SDE é‡Œç›´æ¥æ”¹é€Ÿåº¦åœºæ–¹å‘ã€‚\nä¸€ã€æœ€æ ¸å¿ƒçš„ä¸€æ¡å…¬å¼ï¼ˆä½ åªè¦æŠ“ä½å®ƒï¼‰ å‡è®¾ä½ åŸæœ¬æƒ³é‡‡æ ·çš„æ˜¯ç›®æ ‡åˆ†å¸ƒï¼š\n$p(x)$ ç°åœ¨ä½ å¼•å…¥ä¸€ä¸ªåå¥½ï¼ˆloss / reward / constraintï¼‰ï¼Œå®šä¹‰ä¸€ä¸ªæ–°ç›®æ ‡åˆ†å¸ƒï¼š\n$p_{\\text{guided}}(x) \\propto p(x)\\,\\exp(\\lambda R(x))$ å…¶ä¸­ï¼š\n$R(x)$ï¼šrewardï¼ˆæˆ– $-L(x)$ï¼‰ $\\lambda$ï¼šå¼ºåº¦ è¿™æ˜¯ä¸€ä¸ªéå¸¸æ ‡å‡†çš„æ¦‚ç‡å»ºæ¨¡æ“ä½œï¼ˆèƒ½é‡æ¨¡å‹ã€è´å¶æ–¯åéªŒã€Boltzmann åˆ†å¸ƒï¼‰ã€‚\näºŒã€è¿™ä¸€æ­¥ç›´æ¥ç»™å‡ºâ€œä¸ºä»€ä¹ˆæ¢¯åº¦èƒ½åŠ â€ å¯¹æ–°åˆ†å¸ƒå– logï¼Œå†å¯¹ $x$ æ±‚æ¢¯åº¦ï¼š\n$\\nabla_x \\log p_{\\text{guided}}(x) = \\nabla_x \\log p(x) + \\lambda \\nabla_x R(x)$ ä¹Ÿå°±æ˜¯ï¼š\n$\\nabla_x \\log p(x)$ï¼šåŸ score $\\lambda \\nabla_x R(x)$ï¼šloss / reward æ¢¯åº¦ äºæ˜¯ç«‹åˆ»å¾—åˆ°ï¼š\n$\\text{new score} = \\text{old score} + \\lambda \\nabla_x R(x)$ è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæ¢¯åº¦å¯ä»¥ç›´æ¥åŠ åœ¨ score ä¸Šã€‚\nä¸æ˜¯ heuristicï¼Œè€Œæ˜¯ç›®æ ‡åˆ†å¸ƒæ”¹å˜åçš„ç²¾ç¡®ç»“æœã€‚\nä¸‰ã€é‚£ diffusion çš„åå‘é‡‡æ ·åœ¨ç”¨ä»€ä¹ˆï¼Ÿ åå‘é‡‡æ ·çš„ç»“æ„æœ¬è´¨æ˜¯ï¼š\nscore å†³å®š drift + éšæœºå™ªå£°\nç°åœ¨æˆ‘ä»¬åªæ˜¯æŠŠï¼š\nåŸæ¥çš„ scoreï¼š$\\nabla_x \\log p(x_t)$ æ¢æˆäº†ï¼š\næ–°ç›®æ ‡åˆ†å¸ƒçš„ scoreï¼š$\\nabla_x \\log p_{\\text{guided}}(x_t)$ å› æ­¤åå‘ä¸€æ­¥çš„å½¢å¼è‡ªç„¶å˜æˆï¼ˆç¤ºæ„å†™æ³•ï¼‰ï¼š\n$x_{t-1} \\leftarrow x_t + \\text{step}\\cdot\\big(s_\\theta(x_t, t) + \\lambda \\nabla_{x_t} R(\\hat{x}_0)\\big) + \\text{noise}$ è¯­ä¹‰æ˜¯å®Œå…¨ä¸€è‡´çš„ï¼š\n$s_\\theta(x_t,t)$ï¼šæ¨¡å‹ç»™å‡ºçš„åŸ score $\\nabla R(\\hat{x}_0)$ï¼šæŠŠåå¥½é€šè¿‡â€œå½“å‰ä¼°è®¡çš„ clean sampleâ€ä¼ å›åˆ° $x_t$ çš„å¼•å¯¼é¡¹ å› æ­¤ï¼š\nä¸æ˜¯åœ¨â€œä¹±æ”¹ä¸€æ­¥é‡‡æ ·â€ï¼Œè€Œæ˜¯åœ¨å¯¹æ–°çš„ç›®æ ‡åˆ†å¸ƒåšåˆæ³•çš„åå‘æ‰©æ•£ã€‚\nQ1ï¼šä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘å¯ä»¥é€šè¿‡åŸºåˆ†å¸ƒ $p(x)$ï¼Œå†é€šè¿‡æŸäº›å¼•å¯¼ï¼ˆguidanceï¼‰ï¼Œç”Ÿæˆä¸€ä¸ªæ–°çš„åˆ†å¸ƒå—ï¼Ÿ Aï¼šæ˜¯çš„â€”â€”ä½†å¿…é¡»åŠ ä¸Šä¸€å¥éå¸¸å…³é”®çš„é™å®šï¼Œæ‰æ˜¯å®Œå…¨æ­£ç¡®çš„è¯´æ³•ã€‚\nä¸€å¥è¯çš„ç²¾ç¡®å®šå‹ç‰ˆ $ æ˜¯çš„ï¼šä½ å¯ä»¥ä»ä¸€ä¸ªåŸºåˆ†å¸ƒ \\; p(x) \\; å‡ºå‘ï¼Œ é€šè¿‡åœ¨ç”Ÿæˆè¿‡ç¨‹ä¸­åŠ å…¥å¼•å¯¼ï¼ˆguidanceï¼‰ï¼Œ å¾—åˆ°ä¸€ä¸ªâ€œæ–°çš„ã€è¢«åç½®è¿‡çš„ç”Ÿæˆåˆ†å¸ƒâ€ã€‚ ä½†è¿™ä¸ªæ–°åˆ†å¸ƒé€šå¸¸æ˜¯ï¼š è¢«å®šä¹‰åœ¨â€œç”Ÿæˆè¿‡ç¨‹ / è·¯å¾„â€ä¸Šçš„è¿‘ä¼¼åˆ†å¸ƒï¼Œ è€Œä¸ä¸€å®šç­‰ä»·äºä¸€ä¸ªäº‹å…ˆå†™å¥½çš„ã€ä¸¥æ ¼çš„é—­å¼åˆ†å¸ƒã€‚ $ è¿™å¥è¯é‡Œï¼Œâ€œæ˜¯çš„â€æ˜¯çœŸçš„ï¼Œâ€œä½†â€ä¹ŸåŒæ ·é‡è¦ã€‚\nQ2ï¼šé‚£â€œé€šè¿‡å¼•å¯¼å¾—åˆ°æ–°åˆ†å¸ƒâ€åœ¨ç†è®ºä¸Šåˆ°åº•æœ‰å‡ ç§ä¸åŒå±‚çº§çš„å«ä¹‰ï¼Ÿ Aï¼šå¯ä»¥æ¸…æ¥šåœ°åˆ†æˆä¸‰ç§å±‚çº§ï¼Œä½ ç°åœ¨é—®çš„å…¶å®æ˜¯åœ¨è¿™ä¸‰è€…ä¹‹é—´åˆ‡æ¢ã€‚\nâœ… æƒ…å½¢ Aï¼šä¸¥æ ¼æˆç«‹ï¼Œæœ‰ç†è®ºä¿è¯ï¼ˆç†æƒ³åŒ–æƒ…å½¢ï¼‰ è®¾å®šï¼š\nè¿ç»­æ—¶é—´ ä½¿ç”¨çœŸå® scoreï¼š\n$\\nabla \\log p(x)$ reward ç›´æ¥ä½œç”¨åœ¨ $x$ ä¸Š ç”¨ Langevin dynamics åŠ¨åŠ›å­¦ä¸ºï¼š\n$ dx = (\\nabla \\log p(x) + \\lambda \\nabla R(x)) dt + \\sqrt{2}\\, dW $ ä¸¥æ ¼ç»“è®ºï¼š\nè¯¥éšæœºè¿‡ç¨‹çš„ä¸å˜åˆ†å¸ƒä¸ºï¼š\n$ p_{\\text{new}}(x) \\propto p(x)\\,\\exp(\\lambda R(x)) $ åœ¨è¿™ä¸ªç†æƒ³è®¾å®šä¸‹ï¼š\nâ€œæˆ‘å¯ä»¥é€šè¿‡ $p(x)$ï¼Œå†é€šè¿‡å¼•å¯¼ï¼Œç”Ÿæˆæ–°çš„åˆ†å¸ƒâ€\næ˜¯ 100% æ­£ç¡®çš„æ•™ç§‘ä¹¦ç»“è®ºã€‚\nâš ï¸ æƒ…å½¢ Bï¼šçœŸå® diffusion / guided diffusion çš„æƒ…å†µ ç°å®ä¸­å‘ç”Ÿäº†è¿™äº›å˜åŒ–ï¼š\n$p(x)$ ä¸æ˜¯ç›´æ¥å»ºæ¨¡ï¼Œè€Œæ˜¯é€šè¿‡å¤šå°ºåº¦ $p_t(x)$ score ç”±ç¥ç»ç½‘ç»œè¿‘ä¼¼ reward é€šå¸¸åœ¨å»å™ªä¼°è®¡\n$\\hat{x}_0(x_t)$\nä¸Šè®¡ç®— ç¦»æ•£æ—¶é—´ã€æœ‰é™æ­¥æ•° å› æ­¤æ›´å‡†ç¡®çš„è¯´æ³•æ˜¯ï¼š\nä½ ä»ä¸€ä¸ªç”± $p(x)$ è¯±å¯¼å‡ºçš„ç”Ÿæˆè¿‡ç¨‹å‡ºå‘ï¼Œ\né€šè¿‡å¼•å¯¼ï¼Œå¾—åˆ°ä¸€ä¸ªæ–°çš„ç”Ÿæˆæœºåˆ¶ï¼Œ\nå®ƒäº§ç”Ÿçš„æ ·æœ¬åˆ†å¸ƒè¢«ç³»ç»Ÿæ€§åœ°åå‘æŸä¸ªç›®æ ‡ã€‚\nä¹Ÿå°±æ˜¯è¯´ï¼š\nâœ” ä½ ç¡®å®ä¸å†é‡‡æ ·åŸå§‹çš„ $p(x)$ âœ˜ ä½†ä½ ä¸èƒ½ä¸¥æ ¼å†™æˆ\n$x_0 \\sim p(x)\\exp(\\lambda R(x))$ è¿™æ˜¯ principled approximationï¼ˆæœ‰åŸåˆ™çš„è¿‘ä¼¼ï¼‰ï¼Œ\nä½†ä¸æ˜¯ä¸¥æ ¼åéªŒé‡‡æ ·å™¨ã€‚\nğŸ§­ æƒ…å½¢ Cï¼šæ§åˆ¶ / æ¨æ–­è§†è§’ï¼ˆå®è·µä¸­æœ€ç¨³å¦¥çš„ç†è§£ï¼‰ åœ¨æ§åˆ¶ä¸æ¨æ–­é‡Œï¼Œæ›´çœŸå®çš„ç†è§£æ˜¯ï¼š\nä½ ä¸æ˜¯â€œå…ˆå®šä¹‰ä¸€ä¸ªæ–°åˆ†å¸ƒå†å»é‡‡æ ·â€ï¼Œ\nè€Œæ˜¯åœ¨ä¸€ä¸ªä»¥ $p(x)$ ä¸ºå…ˆéªŒçš„ç”Ÿæˆè¿‡ç¨‹ä¸­ï¼Œ\nåœ¨çº¿æ–½åŠ åå¥½ï¼Œå¾—åˆ°è¢«å¼•å¯¼çš„è¾“å‡ºåˆ†å¸ƒã€‚\nè¿™åœ¨æ•°å­¦ä¸Šæ›´æ¥è¿‘ï¼š\nKL-regularized inference stochastic optimal control path reweighting è€Œä¸æ˜¯â€œæ¢ä¸€ä¸ªé™æ€ pdfâ€ã€‚\nQ3ï¼šé‚£æˆ‘åˆ°åº•è¯¥æ€ä¹ˆä¸€å¥è¯æ€»ç»“ï¼Œæ‰ä¸ä¼šå†æ··ä¹±ï¼Ÿ Aï¼šä½ å¯ä»¥å®‰å…¨åœ°ä½¿ç”¨ä¸‹é¢è¿™å¥è¯ä½œä¸ºæœ€ç»ˆç»“è®ºã€‚\n$ æ˜¯çš„ï¼Œæˆ‘å¯ä»¥ä» \\; p(x) \\; å‡ºå‘ï¼Œé€šè¿‡å¼•å¯¼ï¼Œç”Ÿæˆä¸€ä¸ªæ–°çš„åˆ†å¸ƒï¼› åªæ˜¯è¿™ä¸ªâ€œæ–°åˆ†å¸ƒâ€çš„ä¸¥æ ¼å«ä¹‰ï¼Œ å–å†³äºæˆ‘æ˜¯åœ¨ç†æƒ³åŒ–çš„ Langevin æƒ…å½¢ä¸‹ï¼Œ è¿˜æ˜¯åœ¨å®é™…çš„ diffusion ç”Ÿæˆè¿‡ç¨‹ä¸­ã€‚ $ åªè¦ä½ è®°ä½è¿™ä¸€ç‚¹ï¼š\nä½ å°±ä¸ä¼šæŠŠ guided diffusion è¯¯å½“æˆâ€œç²¾ç¡®åéªŒé‡‡æ ·â€ ä¹Ÿä¸ä¼šä½ä¼°å®ƒåœ¨ç”Ÿæˆä¸æ§åˆ¶ä¸­çš„ç†è®ºæ­£å½“æ€§ ","wordCount":"832","inLanguage":"en","datePublished":"2026-01-08T00:00:00Z","dateModified":"2026-01-08T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://analyst-huang.github.io/posts/ai/diffusion/"},"publisher":{"@type":"Organization","name":"Blog","logo":{"@type":"ImageObject","url":"https://analyst-huang.github.io/favicon.ico"}}}</script></head><body id=top><header class=header><nav class=nav><div class=logo><a href=https://analyst-huang.github.io/ accesskey=h title="Blog (Alt + H)">Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://analyst-huang.github.io/posts/ title=æ–‡ç« ><span>æ–‡ç« </span></a></li><li><a href=https://analyst-huang.github.io/about/ title=å…³äº><span>å…³äº</span></a></li><li><a href=https://analyst-huang.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://analyst-huang.github.io/>Home</a>&nbsp;Â»&nbsp;<a href=https://analyst-huang.github.io/posts/>Posts</a>&nbsp;Â»&nbsp;<a href=https://analyst-huang.github.io/posts/ai/>AI</a></div><h1 class="post-title entry-hint-parent">Diffusion</h1><div class=post-meta><span title='2026-01-08 00:00:00 +0000 UTC'>January 8, 2026</span>&nbsp;Â·&nbsp;<span>4 min</span></div></header><div class=post-content><p>tæ­¥åŠ å™ªå¯ä»¥å†™æˆå¦‚ä¸‹å½¢å¼ï¼š</p><span class=math style=display:block;text-align:center>$x_t = \sqrt{\bar{\alpha}_t}\, x_0 + \sqrt{1 - \bar{\alpha}_t}\, \varepsilon,\quad \varepsilon \sim \mathcal{N}(0, I)$</span><p>å…¶ä¸­ï¼š</p><span class=math style=display:block;text-align:center>$\alpha_t = 1 - \beta_t,\quad \bar{\alpha}_t = \prod_{s=1}^{t} \alpha_s, \alpha_t \in [0,1] $</span><h2 id=äºŒä¸¥æ ¼æ¨å¯¼ç”¨è´å¶æ–¯å…¬å¼forward-åéªŒ>äºŒã€ä¸¥æ ¼æ¨å¯¼ï¼šç”¨è´å¶æ–¯å…¬å¼ï¼ˆforward åéªŒï¼‰<a hidden class=anchor aria-hidden=true href=#äºŒä¸¥æ ¼æ¨å¯¼ç”¨è´å¶æ–¯å…¬å¼forward-åéªŒ>#</a></h2><h3 id=1-æ¦‚ç‡å›¾ç»“æ„ä¸è´å¶æ–¯å±•å¼€>1) æ¦‚ç‡å›¾ç»“æ„ä¸è´å¶æ–¯å±•å¼€<a hidden class=anchor aria-hidden=true href=#1-æ¦‚ç‡å›¾ç»“æ„ä¸è´å¶æ–¯å±•å¼€>#</a></h3><p>ä»æ¦‚ç‡å›¾ï¼ˆforward é“¾ï¼‰ï¼š
<span class=math style=display:block;text-align:center>$
x_0 \rightarrow x_{t-1} \rightarrow x_t
$</span></p><p>ç”±è´å¶æ–¯å…¬å¼ï¼š
<span class=math style=display:block;text-align:center>$
q(x_{t-1}\mid x_t, x_0)
=
\frac{q(x_t\mid x_{t-1}, x_0)\,q(x_{t-1}\mid x_0)}{q(x_t\mid x_0)}.
$</span></p><p>ç”±äº forward è¿‡ç¨‹çš„é©¬å°”å¯å¤«æ€§ï¼š
<span class=math style=display:block;text-align:center>$
q(x_t\mid x_{t-1}, x_0)=q(x_t\mid x_{t-1}),
$
</span>å› æ­¤ï¼š
<span class=math style=display:block;text-align:center>$
q(x_{t-1}\mid x_t, x_0)
=
\frac{q(x_t\mid x_{t-1})\,q(x_{t-1}\mid x_0)}{q(x_t\mid x_0)}.
$</span></p><hr><h3 id=2-ä¸‰ä¸ªåˆ†å¸ƒéƒ½æ˜¯å·²çŸ¥é«˜æ–¯>2) ä¸‰ä¸ªåˆ†å¸ƒéƒ½æ˜¯å·²çŸ¥é«˜æ–¯<a hidden class=anchor aria-hidden=true href=#2-ä¸‰ä¸ªåˆ†å¸ƒéƒ½æ˜¯å·²çŸ¥é«˜æ–¯>#</a></h3><p>è®°
<span class=math style=display:block;text-align:center>$
\alpha_t = 1-\beta_t,\qquad \bar\alpha_t=\prod_{s=1}^t \alpha_s.
$</span></p><p>forward å•æ­¥ï¼š
<span class=math style=display:block;text-align:center>$
q(x_t\mid x_{t-1})=\mathcal N(\sqrt{\alpha_t}\,x_{t-1},\ \beta_t I).
$</span></p><p>forward è¾¹ç¼˜ï¼ˆé—­å¼ï¼‰ï¼š
<span class=math style=display:block;text-align:center>$
q(x_{t-1}\mid x_0)=\mathcal N(\sqrt{\bar\alpha_{t-1}}\,x_0,\ (1-\bar\alpha_{t-1})I),
$
</span><span class=math style=display:block;text-align:center>$
q(x_t\mid x_0)=\mathcal N(\sqrt{\bar\alpha_t}\,x_0,\ (1-\bar\alpha_t)I).
$</span></p><p>äºæ˜¯ï¼š
<span class=math style=display:block;text-align:center>$
q(x_{t-1}\mid x_t, x_0)
\propto
q(x_t\mid x_{t-1})\,q(x_{t-1}\mid x_0)
$
</span>æ˜¯â€œé«˜æ–¯ Ã— é«˜æ–¯â€çš„å½¢å¼ï¼Œå› æ­¤åéªŒä»ä¸ºé«˜æ–¯ï¼š
<span class=math style=display:block;text-align:center>$
q(x_{t-1}\mid x_t, x_0)
=
\mathcal N\!\big(\mu_t(x_t,x_0),\ \tilde\beta_t I\big).
$</span></p><hr><h3 id=3-åéªŒå‡å€¼ä¸æ–¹å·®ddpm-ç»å…¸é—­å¼>3) åéªŒå‡å€¼ä¸æ–¹å·®ï¼ˆDDPM ç»å…¸é—­å¼ï¼‰<a hidden class=anchor aria-hidden=true href=#3-åéªŒå‡å€¼ä¸æ–¹å·®ddpm-ç»å…¸é—­å¼>#</a></h3><p>åéªŒæ–¹å·®ï¼š
<span class=math style=display:block;text-align:center>$
\tilde\beta_t
=
\frac{1-\bar\alpha_{t-1}}{1-\bar\alpha_t}\,\beta_t.
$</span></p><p>åéªŒå‡å€¼ï¼š
<span class=math style=display:block;text-align:center>$
\mu_t(x_t,x_0)
=
\frac{\sqrt{\bar\alpha_{t-1}}\,\beta_t}{1-\bar\alpha_t}\,x_0
+
\frac{\sqrt{\alpha_t}\,(1-\bar\alpha_{t-1})}{1-\bar\alpha_t}\,x_t.
$</span></p><hr><h3 id=4-å°ç»“>4) å°ç»“<a hidden class=anchor aria-hidden=true href=#4-å°ç»“>#</a></h3><p>æˆ‘ä»¬ä¸¥æ ¼åœ°ä»ï¼š
<span class=math style=display:block;text-align:center>$
q(x_{t-1}\mid x_t,x_0)
=
\frac{q(x_t\mid x_{t-1})\,q(x_{t-1}\mid x_0)}{q(x_t\mid x_0)}
$
</span>å‡ºå‘ï¼Œåˆ©ç”¨ forward é©¬å°”å¯å¤«æ€§ä¸é«˜æ–¯é—­åŒ…æ€§ï¼Œå¾—åˆ°
<span class=math style=display:block;text-align:center>$
q(x_{t-1}\mid x_t,x_0)=\mathcal N(\mu_t,\tilde\beta_t I),
$</span></p><h2 id=å™ªå£°é¢„æµ‹--score-matchingä¸¥æ ¼ç­‰ä»·>å™ªå£°é¢„æµ‹ â‰¡ score matchingï¼ˆä¸¥æ ¼ç­‰ä»·ï¼‰<a hidden class=anchor aria-hidden=true href=#å™ªå£°é¢„æµ‹--score-matchingä¸¥æ ¼ç­‰ä»·>#</a></h2><p>æˆ‘ä»¬çœ‹è®­ç»ƒç›®æ ‡ï¼ˆDDPM å¸¸ç”¨çš„ noise-prediction lossï¼‰ï¼š</p><span class=math style=display:block;text-align:center>$
L(\theta)=\mathbb{E}_{x_0,\varepsilon,t}\,\|\varepsilon-\varepsilon_\theta(x_t,t)\|_2^2,
\qquad
x_t=\sqrt{\bar\alpha_t}\,x_0+\sqrt{1-\bar\alpha_t}\,\varepsilon,\ \ \varepsilon\sim\mathcal N(0,I).
$</span><hr><h2 id=1-æœ€ä¼˜è§£æ˜¯ä»€ä¹ˆ>1) æœ€ä¼˜è§£æ˜¯ä»€ä¹ˆï¼Ÿ<a hidden class=anchor aria-hidden=true href=#1-æœ€ä¼˜è§£æ˜¯ä»€ä¹ˆ>#</a></h2><p>å¯¹å›ºå®šçš„ $t$ ä¸è§‚æµ‹åˆ°çš„ $x_t$ï¼Œè¿™æ˜¯ä¸€ä¸ª**æ¡ä»¶å‡æ–¹è¯¯å·®ï¼ˆconditional MSEï¼‰**é—®é¢˜ã€‚
ä»¤ $f(x_t,t)=\varepsilon_\theta(x_t,t)$ã€‚åœ¨å¹³æ–¹æŸå¤±ä¸‹çš„å”¯ä¸€ï¼ˆå‡ ä¹å¤„å¤„ï¼‰æœ€ä¼˜è§£ä¸ºæ¡ä»¶æœŸæœ›ï¼š</p><span class=math style=display:block;text-align:center>$
\varepsilon_\theta^\star(x_t,t)=\mathbb{E}[\varepsilon\mid x_t,t].
$</span><p>ï¼ˆç›´è§‚ï¼šå¹³æ–¹æŸå¤±çš„å›å½’æœ€ä¼˜é¢„æµ‹ = æ¡ä»¶å‡å€¼ã€‚ï¼‰</p><hr><h2 id=2-ä¸¥æ ¼æ¨å‡ºmathbbevarepsilonmid-x_t-ä¸-score-çš„å…³ç³»>2) ä¸¥æ ¼æ¨å‡ºï¼š$\mathbb{E}[\varepsilon\mid x_t]$ ä¸ score çš„å…³ç³»<a hidden class=anchor aria-hidden=true href=#2-ä¸¥æ ¼æ¨å‡ºmathbbevarepsilonmid-x_t-ä¸-score-çš„å…³ç³»>#</a></h2><p>ç”±ï¼ˆVincent 2011 / Tweedie å…¬å¼çš„å½¢å¼ï¼‰ï¼š</p><span class=math style=display:block;text-align:center>$
\boxed{
\mathbb{E}[\varepsilon\mid x_t]
=
-\sqrt{1-\bar\alpha_t}\ \nabla_{x_t}\log p_t(x_t)
}
$</span><hr><h2 id=3-æŠŠå®ƒå†™æˆ-å™ªå£°é¢„æµ‹--score-çš„ç­‰å¼>3) æŠŠå®ƒå†™æˆ â€œå™ªå£°é¢„æµ‹ â†” scoreâ€ çš„ç­‰å¼<a hidden class=anchor aria-hidden=true href=#3-æŠŠå®ƒå†™æˆ-å™ªå£°é¢„æµ‹--score-çš„ç­‰å¼>#</a></h2><p>å› ä¸ºè®­ç»ƒä½¿å¾— $\varepsilon_\theta(x_t,t)\approx \mathbb{E}[\varepsilon\mid x_t]$ï¼Œäºæ˜¯</p><span class=math style=display:block;text-align:center>$
\boxed{
s_\theta(x_t,t)\ \approx\ \nabla_{x_t}\log p_t(x_t)
=
-\frac{1}{\sqrt{1-\bar\alpha_t}}\ \varepsilon_\theta(x_t,t)
}
$</span><p>ä¹Ÿå³</p><span class=math style=display:block;text-align:center>$
\boxed{
\varepsilon_\theta(x_t,t)\ \approx\ -\sqrt{1-\bar\alpha_t}\ s_\theta(x_t,t)
}
$</span><hr><h2 id=5-ä¸€å¥è¯ç›´è§‰>5) ä¸€å¥è¯ç›´è§‰<a hidden class=anchor aria-hidden=true href=#5-ä¸€å¥è¯ç›´è§‰>#</a></h2><ul><li>noise-prediction å›å½’åˆ° $\mathbb{E}[\varepsilon\mid x_t]$</li><li>ç”±äºé«˜æ–¯å·ç§¯çš„è§£ææ€§è´¨ï¼Œè¿™ä¸ªæ¡ä»¶å‡å€¼<strong>ç­‰ä»·äº</strong>è¾¹ç¼˜å¯†åº¦ $p_t$ çš„ scoreï¼ˆå·®ä¸€ä¸ªç¡®å®šç³»æ•°ï¼‰</li><li>æ‰€ä»¥ â€œé¢„æµ‹å™ªå£°â€ å’Œ â€œscore matchingâ€ åœ¨è¿™é‡Œæ˜¯ä¸¥æ ¼åŒä¸€ä»¶äº‹ï¼ˆåªæ˜¯å‚æ•°åŒ–å½¢å¼ä¸åŒï¼‰</li></ul><p>æœ€å¸¸ç”¨çš„ DDPM é‡‡æ ·å†™æ³•æ˜¯ï¼š</p><p><span class=math style=display:block;text-align:center>$
\sigma_t^2 = \tilde{\beta}_t \;=\; \frac{1 - \bar{\alpha}_{t-1}}{1 - \bar{\alpha}_t}\,\beta_t
$
</span>,
<span class=math style=display:block;text-align:center>$
x_{t-1}
=
\sqrt{\frac{1}{\alpha_t}}
\Big(
x_t
-
\frac{\beta_t}{\sqrt{1-\bar{\alpha}_t}}
\,
\varepsilon_\theta(x_t, t)
\Big)
+
\sigma_t z,
\quad
z \sim \mathcal{N}(0, I)
$</span></p><h3 id=3-ç”¨-score-æ¥å†™åŒä¸€æ¡å…¬å¼æ›´ç›´è§‚>3) ç”¨ score æ¥å†™åŒä¸€æ¡å…¬å¼ï¼ˆæ›´ç›´è§‚ï¼‰<a hidden class=anchor aria-hidden=true href=#3-ç”¨-score-æ¥å†™åŒä¸€æ¡å…¬å¼æ›´ç›´è§‚>#</a></h3><p>æŠŠä¸Šé¢ç¬¬ (1) æ¡ä»£è¿›å»ï¼Œä½ ä¼šçœ‹åˆ°åå‘ä¸€æ­¥å¤§è‡´å°±æ˜¯ï¼š</p><span class=math style=display:block;text-align:center>$
x_{t-1}
\;\approx\;
\underbrace{\sqrt{\frac{1}{\alpha_t}} x_t}_{\text{çº¿æ€§â€œå»è¡°å‡â€}}
\;+\;
\underbrace{\frac{\beta_t}{\alpha_t}\, s_\theta(x_t, t)}_{\text{æ²¿ score å¾€é«˜æ¦‚ç‡åŒºæ¨}}
\;+\;
\underbrace{\sigma_t z}_{\text{éšæœºæ€§ï¼ˆä¿ç•™å¤šè§£/å¤šæ¨¡æ€ï¼‰}},
\quad z \sim \mathcal{N}(0, I)
$</span><p>è¿™å°±æ˜¯ä½ æƒ³è¦çš„ç›´è§‰æŠŠæ¡ï¼š</p><ul><li><strong>score é¡¹</strong>ï¼šå‘Šè¯‰ä½ å¾€å“ªé‡Œèµ°æ›´åƒæ•°æ®ï¼ˆå¾€é«˜å¯†åº¦åŒºæ¨ï¼‰</li><li><strong>éšæœºé¡¹</strong>ï¼šä¿è¯ä½ ä¸æ˜¯â€œçˆ¬å±±çˆ¬åˆ°æŸä¸ªå³°å°±å¡Œç¼©â€ï¼Œè€Œæ˜¯èƒ½è¦†ç›–åˆ†å¸ƒçš„ä¸åŒæ¨¡å¼</li><li><strong>çº¿æ€§é¡¹</strong>ï¼šå¯¹åº”æ­£å‘é‡Œé‚£ä¸€ç‚¹ç‚¹ç¼©æ”¾/è¡°å‡çš„é€†æ“ä½œ</li></ul><h1 id=ä¸€ä¸€æ­¥å»å™ªä»-x_t-å¾—åˆ°å½“å‰è®¤ä¸ºçš„-clean-sample>ä¸€ã€ä¸€æ­¥å»å™ªï¼šä» $x_t$ å¾—åˆ°â€œå½“å‰è®¤ä¸ºçš„ clean sampleâ€<a hidden class=anchor aria-hidden=true href=#ä¸€ä¸€æ­¥å»å™ªä»-x_t-å¾—åˆ°å½“å‰è®¤ä¸ºçš„-clean-sample>#</a></h1><p>ä½ ç°åœ¨å·²ç»çŸ¥é“ç½‘ç»œåœ¨é¢„æµ‹å™ªå£°ï¼š</p><span class=math style=display:block;text-align:center>$
\varepsilon_\theta(x_t, t)
$</span><p>æ ‡å‡†çš„ä¸€æ­¥å»å™ªå…¬å¼å°±æ˜¯ç›´æ¥æŠŠå™ªå£°â€œå‡æ‰â€ï¼š</p><span class=math style=display:block;text-align:center>$
\hat{x}_0(x_t)
=
\frac{1}{\sqrt{\bar{\alpha}_t}}
\left(
x_t
-
\sqrt{1 - \bar{\alpha}_t}\;
\varepsilon_\theta(x_t, t)
\right)
$</span><p>ç›´è§‰ç†è§£ï¼š</p><ul><li>$ x_t $ï¼šç°åœ¨è¿™ä¸ªå¸¦å™ªçš„æ ·æœ¬</li><li>$ \varepsilon_\theta $ï¼šæ¨¡å‹è®¤ä¸ºâ€œè¿™é‡Œé¢æœ‰å¤šå°‘æ˜¯å™ªå£°â€</li><li>$ \hat{x}_0 $ï¼šåœ¨ç¬¬ $t$ æ­¥ï¼Œæ¨¡å‹å¿ƒä¸­â€œæœ€å¯èƒ½çš„å¹²å‡€æ ·æœ¬â€</li></ul><blockquote><p><strong>é‡è¦å¼ºè°ƒï¼ˆé˜²æ­¢è¯¯è§£ï¼‰ï¼š</strong><br>$ \hat{x}_0 $ ä¸æ˜¯æœ€ç»ˆç”Ÿæˆç»“æœï¼Œ<br>å®ƒåªæ˜¯å½“å‰è¿™ä¸€æ­¥çš„â€œä¸´æ—¶ clean è§£é‡Šâ€ã€‚</p></blockquote><hr><h1 id=äºŒguidance-çš„æ ¸å¿ƒæ€æƒ³ä¸€å¥è¯ç‰ˆ>äºŒã€Guidance çš„æ ¸å¿ƒæ€æƒ³ï¼ˆä¸€å¥è¯ç‰ˆï¼‰<a hidden class=anchor aria-hidden=true href=#äºŒguidance-çš„æ ¸å¿ƒæ€æƒ³ä¸€å¥è¯ç‰ˆ>#</a></h1><p>ç°åœ¨å‡è®¾ä½ æœ‰ä¸€ä¸ªç›®æ ‡å‡½æ•°ï¼ˆæˆ–æŸå¤±ï¼‰ï¼š</p><span class=math style=display:block;text-align:center>$
L(x_0) \quad \text{æˆ–} \quad R(x_0)
$</span><p>ä¾‹å¦‚ï¼š</p><ul><li>å’Œç›®æ ‡å›¾åƒçš„è·ç¦»</li><li>æ˜¯å¦æ»¡è¶³æŸä¸ªçº¦æŸ</li><li>è½¨è¿¹ reward</li><li>classifier çš„ log-prob</li></ul><p><strong>Guidance çš„æ€æƒ³åªæœ‰ä¸€å¥è¯ï¼š</strong></p><blockquote><p>æ—¢ç„¶æˆ‘å·²ç»èƒ½åœ¨æ¯ä¸€æ­¥å¾—åˆ°ä¸€ä¸ª $ \hat{x}_0 $ï¼Œ<br>é‚£æˆ‘å°±å¯ä»¥åœ¨â€œé‡‡æ ·è¿‡ç¨‹ä¸­â€<br>å¯¹è¿™ä¸ª $ \hat{x}_0 $ æ–½åŠ æ¢¯åº¦ä¿®æ­£ã€‚</p></blockquote><hr><h1 id=ä¸‰æ¢¯åº¦æ˜¯æ€ä¹ˆçœŸæ­£è¿›-sample-è¿‡ç¨‹çš„>ä¸‰ã€æ¢¯åº¦æ˜¯æ€ä¹ˆçœŸæ­£â€œè¿› sample è¿‡ç¨‹â€çš„ï¼Ÿ<a hidden class=anchor aria-hidden=true href=#ä¸‰æ¢¯åº¦æ˜¯æ€ä¹ˆçœŸæ­£è¿›-sample-è¿‡ç¨‹çš„>#</a></h1><p>è¿™æ˜¯å…³é”®éƒ¨åˆ†ï¼Œåˆ†ä¸‰æ­¥ã€‚</p><hr><h2 id=1-å…ˆåœ¨-clean-space-é‡Œç®—æ¢¯åº¦>1ï¸âƒ£ å…ˆåœ¨ clean space é‡Œç®—æ¢¯åº¦<a hidden class=anchor aria-hidden=true href=#1-å…ˆåœ¨-clean-space-é‡Œç®—æ¢¯åº¦>#</a></h2><p>å…ˆåœ¨å¹²å‡€ç©ºé—´è®¡ç®—æ¢¯åº¦ï¼š</p><span class=math style=display:block;text-align:center>$
g
=
\nabla_{\hat{x}_0}\, \big( - L(\hat{x}_0) \big)
$</span><p>å¦‚æœæ˜¯ rewardï¼Œåˆ™æ˜¯ï¼š</p><span class=math style=display:block;text-align:center>$
\nabla_{\hat{x}_0}\, R(\hat{x}_0)
$</span><p><strong>ç›´è§‰ï¼š</strong></p><p>è¿™ä¸ªæ¢¯åº¦å‘Šè¯‰ä½ ï¼š<br>å¦‚æœæˆ‘æ˜¯ä¸€ä¸ªå¹²å‡€æ ·æœ¬ï¼Œå¾€å“ªé‡ŒåŠ¨èƒ½è®© loss å˜å° / reward å˜å¤§ã€‚</p><hr><h2 id=2-æŠŠæ¢¯åº¦ä¼ å›åˆ°å½“å‰å™ªå£°å±‚>2ï¸âƒ£ æŠŠæ¢¯åº¦â€œä¼ å›â€åˆ°å½“å‰å™ªå£°å±‚<a hidden class=anchor aria-hidden=true href=#2-æŠŠæ¢¯åº¦ä¼ å›åˆ°å½“å‰å™ªå£°å±‚>#</a></h2><p>å…³é”®å…³ç³»æ˜¯ï¼š</p><span class=math style=display:block;text-align:center>$
\hat{x}_0
=
\frac{1}{\sqrt{\bar{\alpha}_t}} x_t
-
\frac{\sqrt{1-\bar{\alpha}_t}}{\sqrt{\bar{\alpha}_t}}
\varepsilon_\theta(x_t, t)
$</span><p>å¯¹ $ x_t $ æ±‚å¯¼ï¼š</p><span class=math style=display:block;text-align:center>$
\frac{\partial \hat{x}_0}{\partial x_t}
=
\frac{1}{\sqrt{\bar{\alpha}_t}} I
$</span><p>äºæ˜¯æ¢¯åº¦å›ä¼ éå¸¸ç®€å•ï¼š</p><span class=math style=display:block;text-align:center>$
\nabla_{x_t}\, \big( - L(\hat{x}_0) \big)
=
\frac{1}{\sqrt{\bar{\alpha}_t}}
\nabla_{\hat{x}_0}\, \big( - L(\hat{x}_0) \big)
$</span><p>è¿™ä¸€æ­¥æœ¬è´¨ä¸Šæ˜¯åœ¨åšï¼š</p><blockquote><p>æŠŠ clean-space çš„åå¥½ï¼Œçº¿æ€§æ˜ å°„å›å½“å‰å™ªå£°å±‚ã€‚</p></blockquote><hr><h2 id=3-æŠŠ-guidance-æ¢¯åº¦åŠ è¿›åå‘é‡‡æ ·>3ï¸âƒ£ æŠŠ guidance æ¢¯åº¦åŠ è¿›åå‘é‡‡æ ·<a hidden class=anchor aria-hidden=true href=#3-æŠŠ-guidance-æ¢¯åº¦åŠ è¿›åå‘é‡‡æ ·>#</a></h2><p>æ ‡å‡†åå‘é‡‡æ ·ï¼ˆscore å½¢å¼ï¼Œå¿½ç•¥å¸¸æ•°ç»†èŠ‚ï¼‰ï¼š</p><span class=math style=display:block;text-align:center>$
x_{t-1}
\approx
\frac{1}{\alpha_t} x_t
+
\frac{\beta_t}{\alpha_t} \, s_\theta(x_t, t)
+
\sigma_t z
$</span><p>å…¶ä¸­ï¼š</p><span class=math style=display:block;text-align:center>$
s_\theta(x_t, t) = \nabla_{x_t} \log p(x_t)
$</span><p>åŠ å…¥ guidance åï¼š</p><span class=math style=display:block;text-align:center>$
x_{t-1}
\approx
\frac{1}{\alpha_t} x_t
+
\frac{\beta_t}{\alpha_t}
\left(
s_\theta(x_t, t)
+
\lambda \, \nabla_{x_t} ( - L(\hat{x}_0) )
\right)
+
\sigma_t z
$</span><p>å…¶ä¸­ï¼š</p><ul><li>$ \lambda $ï¼šguidance strengthï¼ˆä¸»è¦è°ƒè¿™ä¸ªï¼‰</li></ul><p>è§£é‡Šï¼š</p><ul><li>åŸæœ¬çš„ score é¡¹ï¼š<br>â†’ â€œåƒæ•°æ®åˆ†å¸ƒçš„æ–¹å‘â€</li><li>æ–°åŠ çš„ guidance æ¢¯åº¦ï¼š<br>â†’ â€œæ›´ç¬¦åˆä»»åŠ¡ç›®æ ‡çš„æ–¹å‘â€</li></ul><p>é‡‡æ ·æ—¶ä¸¤è‚¡åŠ›ä¸€èµ·æ‹‰ç€æ ·æœ¬å¾€å‰èµ°ã€‚</p><hr><h1 id=ä¸€å¥è¯æ€»ç›´è§‰æ€»ç»“>ä¸€å¥è¯æ€»ç›´è§‰æ€»ç»“<a hidden class=anchor aria-hidden=true href=#ä¸€å¥è¯æ€»ç›´è§‰æ€»ç»“>#</a></h1><ol><li>æ¨¡å‹å‘Šè¯‰ä½ ï¼šç°åœ¨è¿™ä¸ª $x_t$ æœ€å¯èƒ½æ¥è‡ªå“ªä¸ª $\hat{x}_0$</li><li>ä½ åœ¨ $\hat{x}_0$ ä¸Šè®¡ç®—ä»»åŠ¡æ¢¯åº¦</li><li>é€šè¿‡çº¿æ€§å…³ç³»æŠŠæ¢¯åº¦ä¼ å› $x_t$</li><li>åœ¨åå‘æ‰©æ•£æ—¶æŠŠè¿™ä¸ªæ–¹å‘åŠ è¿› drift</li></ol><p>æ‰€ä»¥ guidance ä¸æ˜¯æ”¹è®­ç»ƒç›®æ ‡ï¼Œ<br>è€Œæ˜¯<strong>åœ¨é‡‡æ · ODE / SDE é‡Œç›´æ¥æ”¹é€Ÿåº¦åœºæ–¹å‘</strong>ã€‚</p><h1 id=ä¸€æœ€æ ¸å¿ƒçš„ä¸€æ¡å…¬å¼ä½ åªè¦æŠ“ä½å®ƒ>ä¸€ã€æœ€æ ¸å¿ƒçš„ä¸€æ¡å…¬å¼ï¼ˆä½ åªè¦æŠ“ä½å®ƒï¼‰<a hidden class=anchor aria-hidden=true href=#ä¸€æœ€æ ¸å¿ƒçš„ä¸€æ¡å…¬å¼ä½ åªè¦æŠ“ä½å®ƒ>#</a></h1><p>å‡è®¾ä½ åŸæœ¬æƒ³é‡‡æ ·çš„æ˜¯ç›®æ ‡åˆ†å¸ƒï¼š</p><span class=math style=display:block;text-align:center>$p(x)$</span><p>ç°åœ¨ä½ å¼•å…¥ä¸€ä¸ªåå¥½ï¼ˆloss / reward / constraintï¼‰ï¼Œå®šä¹‰ä¸€ä¸ªæ–°ç›®æ ‡åˆ†å¸ƒï¼š</p><span class=math style=display:block;text-align:center>$p_{\text{guided}}(x) \propto p(x)\,\exp(\lambda R(x))$</span><p>å…¶ä¸­ï¼š</p><ul><li>$R(x)$ï¼šrewardï¼ˆæˆ– $-L(x)$ï¼‰</li><li>$\lambda$ï¼šå¼ºåº¦</li></ul><p>è¿™æ˜¯ä¸€ä¸ªéå¸¸æ ‡å‡†çš„æ¦‚ç‡å»ºæ¨¡æ“ä½œï¼ˆèƒ½é‡æ¨¡å‹ã€è´å¶æ–¯åéªŒã€Boltzmann åˆ†å¸ƒï¼‰ã€‚</p><hr><h1 id=äºŒè¿™ä¸€æ­¥ç›´æ¥ç»™å‡ºä¸ºä»€ä¹ˆæ¢¯åº¦èƒ½åŠ >äºŒã€è¿™ä¸€æ­¥ç›´æ¥ç»™å‡ºâ€œä¸ºä»€ä¹ˆæ¢¯åº¦èƒ½åŠ â€<a hidden class=anchor aria-hidden=true href=#äºŒè¿™ä¸€æ­¥ç›´æ¥ç»™å‡ºä¸ºä»€ä¹ˆæ¢¯åº¦èƒ½åŠ >#</a></h1><p>å¯¹æ–°åˆ†å¸ƒå– logï¼Œå†å¯¹ $x$ æ±‚æ¢¯åº¦ï¼š</p><span class=math style=display:block;text-align:center>$\nabla_x \log p_{\text{guided}}(x)
= \nabla_x \log p(x)
+ \lambda \nabla_x R(x)$</span><p>ä¹Ÿå°±æ˜¯ï¼š</p><ul><li>$\nabla_x \log p(x)$ï¼šåŸ score</li><li>$\lambda \nabla_x R(x)$ï¼šloss / reward æ¢¯åº¦</li></ul><p>äºæ˜¯ç«‹åˆ»å¾—åˆ°ï¼š</p><span class=math style=display:block;text-align:center>$\text{new score} = \text{old score} + \lambda \nabla_x R(x)$</span><p>è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæ¢¯åº¦å¯ä»¥<strong>ç›´æ¥åŠ åœ¨ score ä¸Š</strong>ã€‚<br>ä¸æ˜¯ heuristicï¼Œè€Œæ˜¯<strong>ç›®æ ‡åˆ†å¸ƒæ”¹å˜åçš„ç²¾ç¡®ç»“æœ</strong>ã€‚</p><hr><h1 id=ä¸‰é‚£-diffusion-çš„åå‘é‡‡æ ·åœ¨ç”¨ä»€ä¹ˆ>ä¸‰ã€é‚£ diffusion çš„åå‘é‡‡æ ·åœ¨ç”¨ä»€ä¹ˆï¼Ÿ<a hidden class=anchor aria-hidden=true href=#ä¸‰é‚£-diffusion-çš„åå‘é‡‡æ ·åœ¨ç”¨ä»€ä¹ˆ>#</a></h1><p>åå‘é‡‡æ ·çš„ç»“æ„æœ¬è´¨æ˜¯ï¼š</p><blockquote><p>score å†³å®š drift + éšæœºå™ªå£°</p></blockquote><p>ç°åœ¨æˆ‘ä»¬åªæ˜¯æŠŠï¼š</p><ul><li>åŸæ¥çš„ scoreï¼š$\nabla_x \log p(x_t)$</li></ul><p>æ¢æˆäº†ï¼š</p><ul><li>æ–°ç›®æ ‡åˆ†å¸ƒçš„ scoreï¼š$\nabla_x \log p_{\text{guided}}(x_t)$</li></ul><p>å› æ­¤åå‘ä¸€æ­¥çš„å½¢å¼è‡ªç„¶å˜æˆï¼ˆç¤ºæ„å†™æ³•ï¼‰ï¼š</p><span class=math style=display:block;text-align:center>$x_{t-1} \leftarrow x_t
+ \text{step}\cdot\big(s_\theta(x_t, t)
+ \lambda \nabla_{x_t} R(\hat{x}_0)\big)
+ \text{noise}$</span><p>è¯­ä¹‰æ˜¯å®Œå…¨ä¸€è‡´çš„ï¼š</p><ul><li>$s_\theta(x_t,t)$ï¼šæ¨¡å‹ç»™å‡ºçš„åŸ score</li><li>$\nabla R(\hat{x}_0)$ï¼šæŠŠåå¥½é€šè¿‡â€œå½“å‰ä¼°è®¡çš„ clean sampleâ€ä¼ å›åˆ° $x_t$ çš„å¼•å¯¼é¡¹</li></ul><p>å› æ­¤ï¼š<br><strong>ä¸æ˜¯åœ¨â€œä¹±æ”¹ä¸€æ­¥é‡‡æ ·â€ï¼Œè€Œæ˜¯åœ¨å¯¹æ–°çš„ç›®æ ‡åˆ†å¸ƒåšåˆæ³•çš„åå‘æ‰©æ•£ã€‚</strong></p><h2 id=q1ä¹Ÿå°±æ˜¯è¯´æˆ‘å¯ä»¥é€šè¿‡åŸºåˆ†å¸ƒ-pxå†é€šè¿‡æŸäº›å¼•å¯¼guidanceç”Ÿæˆä¸€ä¸ªæ–°çš„åˆ†å¸ƒå—>Q1ï¼šä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘å¯ä»¥é€šè¿‡åŸºåˆ†å¸ƒ $p(x)$ï¼Œå†é€šè¿‡æŸäº›å¼•å¯¼ï¼ˆguidanceï¼‰ï¼Œç”Ÿæˆä¸€ä¸ªæ–°çš„åˆ†å¸ƒå—ï¼Ÿ<a hidden class=anchor aria-hidden=true href=#q1ä¹Ÿå°±æ˜¯è¯´æˆ‘å¯ä»¥é€šè¿‡åŸºåˆ†å¸ƒ-pxå†é€šè¿‡æŸäº›å¼•å¯¼guidanceç”Ÿæˆä¸€ä¸ªæ–°çš„åˆ†å¸ƒå—>#</a></h2><p><strong>Aï¼šæ˜¯çš„â€”â€”ä½†å¿…é¡»åŠ ä¸Šä¸€å¥éå¸¸å…³é”®çš„é™å®šï¼Œæ‰æ˜¯å®Œå…¨æ­£ç¡®çš„è¯´æ³•ã€‚</strong></p><h3 id=ä¸€å¥è¯çš„ç²¾ç¡®å®šå‹ç‰ˆ>ä¸€å¥è¯çš„ç²¾ç¡®å®šå‹ç‰ˆ<a hidden class=anchor aria-hidden=true href=#ä¸€å¥è¯çš„ç²¾ç¡®å®šå‹ç‰ˆ>#</a></h3><span class=math style=display:block;text-align:center>$
æ˜¯çš„ï¼šä½ å¯ä»¥ä»ä¸€ä¸ªåŸºåˆ†å¸ƒ \; p(x) \; å‡ºå‘ï¼Œ
é€šè¿‡åœ¨ç”Ÿæˆè¿‡ç¨‹ä¸­åŠ å…¥å¼•å¯¼ï¼ˆguidanceï¼‰ï¼Œ
å¾—åˆ°ä¸€ä¸ªâ€œæ–°çš„ã€è¢«åç½®è¿‡çš„ç”Ÿæˆåˆ†å¸ƒâ€ã€‚
ä½†è¿™ä¸ªæ–°åˆ†å¸ƒé€šå¸¸æ˜¯ï¼š
è¢«å®šä¹‰åœ¨â€œç”Ÿæˆè¿‡ç¨‹ / è·¯å¾„â€ä¸Šçš„è¿‘ä¼¼åˆ†å¸ƒï¼Œ
è€Œä¸ä¸€å®šç­‰ä»·äºä¸€ä¸ªäº‹å…ˆå†™å¥½çš„ã€ä¸¥æ ¼çš„é—­å¼åˆ†å¸ƒã€‚
$</span><p>è¿™å¥è¯é‡Œï¼Œâ€œæ˜¯çš„â€æ˜¯çœŸçš„ï¼Œâ€œä½†â€ä¹ŸåŒæ ·é‡è¦ã€‚</p><h2 id=q2é‚£é€šè¿‡å¼•å¯¼å¾—åˆ°æ–°åˆ†å¸ƒåœ¨ç†è®ºä¸Šåˆ°åº•æœ‰å‡ ç§ä¸åŒå±‚çº§çš„å«ä¹‰>Q2ï¼šé‚£â€œé€šè¿‡å¼•å¯¼å¾—åˆ°æ–°åˆ†å¸ƒâ€åœ¨ç†è®ºä¸Šåˆ°åº•æœ‰å‡ ç§ä¸åŒå±‚çº§çš„å«ä¹‰ï¼Ÿ<a hidden class=anchor aria-hidden=true href=#q2é‚£é€šè¿‡å¼•å¯¼å¾—åˆ°æ–°åˆ†å¸ƒåœ¨ç†è®ºä¸Šåˆ°åº•æœ‰å‡ ç§ä¸åŒå±‚çº§çš„å«ä¹‰>#</a></h2><p><strong>Aï¼šå¯ä»¥æ¸…æ¥šåœ°åˆ†æˆä¸‰ç§å±‚çº§ï¼Œä½ ç°åœ¨é—®çš„å…¶å®æ˜¯åœ¨è¿™ä¸‰è€…ä¹‹é—´åˆ‡æ¢ã€‚</strong></p><h3 id=-æƒ…å½¢-aä¸¥æ ¼æˆç«‹æœ‰ç†è®ºä¿è¯ç†æƒ³åŒ–æƒ…å½¢>âœ… æƒ…å½¢ Aï¼šä¸¥æ ¼æˆç«‹ï¼Œæœ‰ç†è®ºä¿è¯ï¼ˆç†æƒ³åŒ–æƒ…å½¢ï¼‰<a hidden class=anchor aria-hidden=true href=#-æƒ…å½¢-aä¸¥æ ¼æˆç«‹æœ‰ç†è®ºä¿è¯ç†æƒ³åŒ–æƒ…å½¢>#</a></h3><p>è®¾å®šï¼š</p><ul><li>è¿ç»­æ—¶é—´</li><li>ä½¿ç”¨çœŸå® scoreï¼š<br>$\nabla \log p(x)$</li><li>reward ç›´æ¥ä½œç”¨åœ¨ $x$ ä¸Š</li><li>ç”¨ Langevin dynamics</li></ul><p>åŠ¨åŠ›å­¦ä¸ºï¼š</p><span class=math style=display:block;text-align:center>$
dx = (\nabla \log p(x) + \lambda \nabla R(x)) dt + \sqrt{2}\, dW
$</span><p><strong>ä¸¥æ ¼ç»“è®ºï¼š</strong></p><p>è¯¥éšæœºè¿‡ç¨‹çš„ä¸å˜åˆ†å¸ƒä¸ºï¼š</p><span class=math style=display:block;text-align:center>$
p_{\text{new}}(x) \propto p(x)\,\exp(\lambda R(x))
$</span><p>åœ¨è¿™ä¸ªç†æƒ³è®¾å®šä¸‹ï¼š</p><blockquote><p>â€œæˆ‘å¯ä»¥é€šè¿‡ $p(x)$ï¼Œå†é€šè¿‡å¼•å¯¼ï¼Œç”Ÿæˆæ–°çš„åˆ†å¸ƒâ€</p></blockquote><p>æ˜¯ <strong>100% æ­£ç¡®çš„æ•™ç§‘ä¹¦ç»“è®º</strong>ã€‚</p><h3 id=-æƒ…å½¢-bçœŸå®-diffusion--guided-diffusion-çš„æƒ…å†µ>âš ï¸ æƒ…å½¢ Bï¼šçœŸå® diffusion / guided diffusion çš„æƒ…å†µ<a hidden class=anchor aria-hidden=true href=#-æƒ…å½¢-bçœŸå®-diffusion--guided-diffusion-çš„æƒ…å†µ>#</a></h3><p>ç°å®ä¸­å‘ç”Ÿäº†è¿™äº›å˜åŒ–ï¼š</p><ul><li>$p(x)$ ä¸æ˜¯ç›´æ¥å»ºæ¨¡ï¼Œè€Œæ˜¯é€šè¿‡å¤šå°ºåº¦ $p_t(x)$</li><li>score ç”±ç¥ç»ç½‘ç»œè¿‘ä¼¼</li><li>reward é€šå¸¸åœ¨å»å™ªä¼°è®¡<br>$\hat{x}_0(x_t)$<br>ä¸Šè®¡ç®—</li><li>ç¦»æ•£æ—¶é—´ã€æœ‰é™æ­¥æ•°</li></ul><p>å› æ­¤æ›´å‡†ç¡®çš„è¯´æ³•æ˜¯ï¼š</p><blockquote><p>ä½ ä»ä¸€ä¸ªç”± $p(x)$ è¯±å¯¼å‡ºçš„ç”Ÿæˆè¿‡ç¨‹å‡ºå‘ï¼Œ<br>é€šè¿‡å¼•å¯¼ï¼Œå¾—åˆ°ä¸€ä¸ªæ–°çš„ç”Ÿæˆæœºåˆ¶ï¼Œ<br>å®ƒäº§ç”Ÿçš„æ ·æœ¬åˆ†å¸ƒè¢«ç³»ç»Ÿæ€§åœ°åå‘æŸä¸ªç›®æ ‡ã€‚</p></blockquote><p>ä¹Ÿå°±æ˜¯è¯´ï¼š</p><ul><li>âœ” ä½ ç¡®å®ä¸å†é‡‡æ ·åŸå§‹çš„ $p(x)$</li><li>âœ˜ ä½†ä½ ä¸èƒ½ä¸¥æ ¼å†™æˆ<br>$x_0 \sim p(x)\exp(\lambda R(x))$</li></ul><p>è¿™æ˜¯ <strong>principled approximationï¼ˆæœ‰åŸåˆ™çš„è¿‘ä¼¼ï¼‰</strong>ï¼Œ<br>ä½†ä¸æ˜¯ä¸¥æ ¼åéªŒé‡‡æ ·å™¨ã€‚</p><h3 id=-æƒ…å½¢-cæ§åˆ¶--æ¨æ–­è§†è§’å®è·µä¸­æœ€ç¨³å¦¥çš„ç†è§£>ğŸ§­ æƒ…å½¢ Cï¼šæ§åˆ¶ / æ¨æ–­è§†è§’ï¼ˆå®è·µä¸­æœ€ç¨³å¦¥çš„ç†è§£ï¼‰<a hidden class=anchor aria-hidden=true href=#-æƒ…å½¢-cæ§åˆ¶--æ¨æ–­è§†è§’å®è·µä¸­æœ€ç¨³å¦¥çš„ç†è§£>#</a></h3><p>åœ¨æ§åˆ¶ä¸æ¨æ–­é‡Œï¼Œæ›´çœŸå®çš„ç†è§£æ˜¯ï¼š</p><blockquote><p>ä½ ä¸æ˜¯â€œå…ˆå®šä¹‰ä¸€ä¸ªæ–°åˆ†å¸ƒå†å»é‡‡æ ·â€ï¼Œ<br>è€Œæ˜¯åœ¨ä¸€ä¸ªä»¥ $p(x)$ ä¸ºå…ˆéªŒçš„ç”Ÿæˆè¿‡ç¨‹ä¸­ï¼Œ<br>åœ¨çº¿æ–½åŠ åå¥½ï¼Œå¾—åˆ°è¢«å¼•å¯¼çš„è¾“å‡ºåˆ†å¸ƒã€‚</p></blockquote><p>è¿™åœ¨æ•°å­¦ä¸Šæ›´æ¥è¿‘ï¼š</p><ul><li>KL-regularized inference</li><li>stochastic optimal control</li><li>path reweighting</li></ul><p>è€Œä¸æ˜¯â€œæ¢ä¸€ä¸ªé™æ€ pdfâ€ã€‚</p><h2 id=q3é‚£æˆ‘åˆ°åº•è¯¥æ€ä¹ˆä¸€å¥è¯æ€»ç»“æ‰ä¸ä¼šå†æ··ä¹±>Q3ï¼šé‚£æˆ‘åˆ°åº•è¯¥æ€ä¹ˆä¸€å¥è¯æ€»ç»“ï¼Œæ‰ä¸ä¼šå†æ··ä¹±ï¼Ÿ<a hidden class=anchor aria-hidden=true href=#q3é‚£æˆ‘åˆ°åº•è¯¥æ€ä¹ˆä¸€å¥è¯æ€»ç»“æ‰ä¸ä¼šå†æ··ä¹±>#</a></h2><p><strong>Aï¼šä½ å¯ä»¥å®‰å…¨åœ°ä½¿ç”¨ä¸‹é¢è¿™å¥è¯ä½œä¸ºæœ€ç»ˆç»“è®ºã€‚</strong></p><span class=math style=display:block;text-align:center>$
æ˜¯çš„ï¼Œæˆ‘å¯ä»¥ä» \; p(x) \; å‡ºå‘ï¼Œé€šè¿‡å¼•å¯¼ï¼Œç”Ÿæˆä¸€ä¸ªæ–°çš„åˆ†å¸ƒï¼›
åªæ˜¯è¿™ä¸ªâ€œæ–°åˆ†å¸ƒâ€çš„ä¸¥æ ¼å«ä¹‰ï¼Œ
å–å†³äºæˆ‘æ˜¯åœ¨ç†æƒ³åŒ–çš„ Langevin æƒ…å½¢ä¸‹ï¼Œ
è¿˜æ˜¯åœ¨å®é™…çš„ diffusion ç”Ÿæˆè¿‡ç¨‹ä¸­ã€‚
$</span><p>åªè¦ä½ è®°ä½è¿™ä¸€ç‚¹ï¼š</p><ul><li>ä½ å°±ä¸ä¼šæŠŠ guided diffusion è¯¯å½“æˆâ€œç²¾ç¡®åéªŒé‡‡æ ·â€</li><li>ä¹Ÿä¸ä¼šä½ä¼°å®ƒåœ¨ç”Ÿæˆä¸æ§åˆ¶ä¸­çš„ç†è®ºæ­£å½“æ€§</li></ul></div><footer class=post-footer><ul class=post-tags></ul></footer></article></main><footer class=footer><span>&copy; 2026 <a href=https://analyst-huang.github.io/>Blog</a></span> Â·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");if(menu){const e=localStorage.getItem("menu-scroll-position");e&&(menu.scrollLeft=parseInt(e,10)),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}}document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{const e=document.querySelector("html");e.dataset.theme==="dark"?(e.dataset.theme="light",localStorage.setItem("pref-theme","light")):(e.dataset.theme="dark",localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>