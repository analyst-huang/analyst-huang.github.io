---
title: "Diffusion"
date: 2026-01-08
draft: False 
---
tæ­¥åŠ å™ªå¯ä»¥å†™æˆå¦‚ä¸‹å½¢å¼ï¼š

{{< math >}}
$x_t = \sqrt{\bar{\alpha}_t}\, x_0 + \sqrt{1 - \bar{\alpha}_t}\, \varepsilon,\quad \varepsilon \sim \mathcal{N}(0, I)$
{{< /math >}}

å…¶ä¸­ï¼š

{{< math >}}
$\alpha_t = 1 - \beta_t,\quad \bar{\alpha}_t = \prod_{s=1}^{t} \alpha_s, \alpha_t \in [0,1] $
{{< /math >}}

## äºŒã€ä¸¥æ ¼æ¨å¯¼ï¼šç”¨è´å¶æ–¯å…¬å¼ï¼ˆforward åéªŒï¼‰

### 1) æ¦‚ç‡å›¾ç»“æ„ä¸è´å¶æ–¯å±•å¼€

ä»æ¦‚ç‡å›¾ï¼ˆforward é“¾ï¼‰ï¼š
{{< math >}}
$
x_0 \rightarrow x_{t-1} \rightarrow x_t
$
{{< /math >}}

ç”±è´å¶æ–¯å…¬å¼ï¼š
{{< math >}}
$
q(x_{t-1}\mid x_t, x_0)
=
\frac{q(x_t\mid x_{t-1}, x_0)\,q(x_{t-1}\mid x_0)}{q(x_t\mid x_0)}.
$
{{< /math >}}

ç”±äº forward è¿‡ç¨‹çš„é©¬å°”å¯å¤«æ€§ï¼š
{{< math >}}
$
q(x_t\mid x_{t-1}, x_0)=q(x_t\mid x_{t-1}),
$
{{< /math >}}
å› æ­¤ï¼š
{{< math >}}
$
q(x_{t-1}\mid x_t, x_0)
=
\frac{q(x_t\mid x_{t-1})\,q(x_{t-1}\mid x_0)}{q(x_t\mid x_0)}.
$
{{< /math >}}

---

### 2) ä¸‰ä¸ªåˆ†å¸ƒéƒ½æ˜¯å·²çŸ¥é«˜æ–¯

è®°
{{< math >}}
$
\alpha_t = 1-\beta_t,\qquad \bar\alpha_t=\prod_{s=1}^t \alpha_s.
$
{{< /math >}}

forward å•æ­¥ï¼š
{{< math >}}
$
q(x_t\mid x_{t-1})=\mathcal N(\sqrt{\alpha_t}\,x_{t-1},\ \beta_t I).
$
{{< /math >}}

forward è¾¹ç¼˜ï¼ˆé—­å¼ï¼‰ï¼š
{{< math >}}
$
q(x_{t-1}\mid x_0)=\mathcal N(\sqrt{\bar\alpha_{t-1}}\,x_0,\ (1-\bar\alpha_{t-1})I),
$
{{< /math >}}
{{< math >}}
$
q(x_t\mid x_0)=\mathcal N(\sqrt{\bar\alpha_t}\,x_0,\ (1-\bar\alpha_t)I).
$
{{< /math >}}

äºæ˜¯ï¼š
{{< math >}}
$
q(x_{t-1}\mid x_t, x_0)
\propto
q(x_t\mid x_{t-1})\,q(x_{t-1}\mid x_0)
$
{{< /math >}}
æ˜¯â€œé«˜æ–¯ Ã— é«˜æ–¯â€çš„å½¢å¼ï¼Œå› æ­¤åéªŒä»ä¸ºé«˜æ–¯ï¼š
{{< math >}}
$
q(x_{t-1}\mid x_t, x_0)
=
\mathcal N\!\big(\mu_t(x_t,x_0),\ \tilde\beta_t I\big).
$
{{< /math >}}

---

### 3) åéªŒå‡å€¼ä¸æ–¹å·®ï¼ˆDDPM ç»å…¸é—­å¼ï¼‰

åéªŒæ–¹å·®ï¼š
{{< math >}}
$
\tilde\beta_t
=
\frac{1-\bar\alpha_{t-1}}{1-\bar\alpha_t}\,\beta_t.
$
{{< /math >}}

åéªŒå‡å€¼ï¼š
{{< math >}}
$
\mu_t(x_t,x_0)
=
\frac{\sqrt{\bar\alpha_{t-1}}\,\beta_t}{1-\bar\alpha_t}\,x_0
+
\frac{\sqrt{\alpha_t}\,(1-\bar\alpha_{t-1})}{1-\bar\alpha_t}\,x_t.
$
{{< /math >}}

---

### 4) å°ç»“

æˆ‘ä»¬ä¸¥æ ¼åœ°ä»ï¼š
{{< math >}}
$
q(x_{t-1}\mid x_t,x_0)
=
\frac{q(x_t\mid x_{t-1})\,q(x_{t-1}\mid x_0)}{q(x_t\mid x_0)}
$
{{< /math >}}
å‡ºå‘ï¼Œåˆ©ç”¨ forward é©¬å°”å¯å¤«æ€§ä¸é«˜æ–¯é—­åŒ…æ€§ï¼Œå¾—åˆ°
{{< math >}}
$
q(x_{t-1}\mid x_t,x_0)=\mathcal N(\mu_t,\tilde\beta_t I),
$
{{< /math >}}

## å™ªå£°é¢„æµ‹ â‰¡ score matchingï¼ˆä¸¥æ ¼ç­‰ä»·ï¼‰

æˆ‘ä»¬çœ‹è®­ç»ƒç›®æ ‡ï¼ˆDDPM å¸¸ç”¨çš„ noise-prediction lossï¼‰ï¼š

{{< math >}}
$
L(\theta)=\mathbb{E}_{x_0,\varepsilon,t}\,\|\varepsilon-\varepsilon_\theta(x_t,t)\|_2^2,
\qquad
x_t=\sqrt{\bar\alpha_t}\,x_0+\sqrt{1-\bar\alpha_t}\,\varepsilon,\ \ \varepsilon\sim\mathcal N(0,I).
$
{{< /math >}}

---

## 1) æœ€ä¼˜è§£æ˜¯ä»€ä¹ˆï¼Ÿ

å¯¹å›ºå®šçš„ $t$ ä¸è§‚æµ‹åˆ°çš„ $x_t$ï¼Œè¿™æ˜¯ä¸€ä¸ª**æ¡ä»¶å‡æ–¹è¯¯å·®ï¼ˆconditional MSEï¼‰**é—®é¢˜ã€‚
ä»¤ $f(x_t,t)=\varepsilon_\theta(x_t,t)$ã€‚åœ¨å¹³æ–¹æŸå¤±ä¸‹çš„å”¯ä¸€ï¼ˆå‡ ä¹å¤„å¤„ï¼‰æœ€ä¼˜è§£ä¸ºæ¡ä»¶æœŸæœ›ï¼š

{{< math >}}
$
\varepsilon_\theta^\star(x_t,t)=\mathbb{E}[\varepsilon\mid x_t,t].
$
{{< /math >}}

ï¼ˆç›´è§‚ï¼šå¹³æ–¹æŸå¤±çš„å›å½’æœ€ä¼˜é¢„æµ‹ = æ¡ä»¶å‡å€¼ã€‚ï¼‰

---

## 2) ä¸¥æ ¼æ¨å‡ºï¼š$\mathbb{E}[\varepsilon\mid x_t]$ ä¸ score çš„å…³ç³»

ç”±ï¼ˆVincent 2011 / Tweedie å…¬å¼çš„å½¢å¼ï¼‰ï¼š

{{< math >}}
$
\boxed{
\mathbb{E}[\varepsilon\mid x_t]
=
-\sqrt{1-\bar\alpha_t}\ \nabla_{x_t}\log p_t(x_t)
}
$
{{< /math >}}

---

## 3) æŠŠå®ƒå†™æˆ â€œå™ªå£°é¢„æµ‹ â†” scoreâ€ çš„ç­‰å¼

å› ä¸ºè®­ç»ƒä½¿å¾— $\varepsilon_\theta(x_t,t)\approx \mathbb{E}[\varepsilon\mid x_t]$ï¼Œäºæ˜¯

{{< math >}}
$
\boxed{
s_\theta(x_t,t)\ \approx\ \nabla_{x_t}\log p_t(x_t)
=
-\frac{1}{\sqrt{1-\bar\alpha_t}}\ \varepsilon_\theta(x_t,t)
}
$
{{< /math >}}

ä¹Ÿå³

{{< math >}}
$
\boxed{
\varepsilon_\theta(x_t,t)\ \approx\ -\sqrt{1-\bar\alpha_t}\ s_\theta(x_t,t)
}
$
{{< /math >}}

---

## 5) ä¸€å¥è¯ç›´è§‰

- noise-prediction å›å½’åˆ° $\mathbb{E}[\varepsilon\mid x_t]$
- ç”±äºé«˜æ–¯å·ç§¯çš„è§£ææ€§è´¨ï¼Œè¿™ä¸ªæ¡ä»¶å‡å€¼**ç­‰ä»·äº**è¾¹ç¼˜å¯†åº¦ $p_t$ çš„ scoreï¼ˆå·®ä¸€ä¸ªç¡®å®šç³»æ•°ï¼‰
- æ‰€ä»¥ â€œé¢„æµ‹å™ªå£°â€ å’Œ â€œscore matchingâ€ åœ¨è¿™é‡Œæ˜¯ä¸¥æ ¼åŒä¸€ä»¶äº‹ï¼ˆåªæ˜¯å‚æ•°åŒ–å½¢å¼ä¸åŒï¼‰

æœ€å¸¸ç”¨çš„ DDPM é‡‡æ ·å†™æ³•æ˜¯ï¼š


{{< math >}}
$
\sigma_t^2 = \tilde{\beta}_t \;=\; \frac{1 - \bar{\alpha}_{t-1}}{1 - \bar{\alpha}_t}\,\beta_t
$
{{< /math >}}
,
{{< math >}}
$
x_{t-1}
=
\sqrt{\frac{1}{\alpha_t}}
\Big(
x_t
-
\frac{\beta_t}{\sqrt{1-\bar{\alpha}_t}}
\,
\varepsilon_\theta(x_t, t)
\Big)
+
\sigma_t z,
\quad
z \sim \mathcal{N}(0, I)
$
{{< /math >}}

### 3) ç”¨ score æ¥å†™åŒä¸€æ¡å…¬å¼ï¼ˆæ›´ç›´è§‚ï¼‰

æŠŠä¸Šé¢ç¬¬ (1) æ¡ä»£è¿›å»ï¼Œä½ ä¼šçœ‹åˆ°åå‘ä¸€æ­¥å¤§è‡´å°±æ˜¯ï¼š

{{< math >}}
$
x_{t-1}
\;\approx\;
\underbrace{\sqrt{\frac{1}{\alpha_t}} x_t}_{\text{çº¿æ€§â€œå»è¡°å‡â€}}
\;+\;
\underbrace{\frac{\beta_t}{\alpha_t}\, s_\theta(x_t, t)}_{\text{æ²¿ score å¾€é«˜æ¦‚ç‡åŒºæ¨}}
\;+\;
\underbrace{\sigma_t z}_{\text{éšæœºæ€§ï¼ˆä¿ç•™å¤šè§£/å¤šæ¨¡æ€ï¼‰}},
\quad z \sim \mathcal{N}(0, I)
$
{{< /math >}}

è¿™å°±æ˜¯ä½ æƒ³è¦çš„ç›´è§‰æŠŠæ¡ï¼š

- **score é¡¹**ï¼šå‘Šè¯‰ä½ å¾€å“ªé‡Œèµ°æ›´åƒæ•°æ®ï¼ˆå¾€é«˜å¯†åº¦åŒºæ¨ï¼‰
- **éšæœºé¡¹**ï¼šä¿è¯ä½ ä¸æ˜¯â€œçˆ¬å±±çˆ¬åˆ°æŸä¸ªå³°å°±å¡Œç¼©â€ï¼Œè€Œæ˜¯èƒ½è¦†ç›–åˆ†å¸ƒçš„ä¸åŒæ¨¡å¼
- **çº¿æ€§é¡¹**ï¼šå¯¹åº”æ­£å‘é‡Œé‚£ä¸€ç‚¹ç‚¹ç¼©æ”¾/è¡°å‡çš„é€†æ“ä½œ

# ä¸€ã€ä¸€æ­¥å»å™ªï¼šä» $x_t$ å¾—åˆ°â€œå½“å‰è®¤ä¸ºçš„ clean sampleâ€

ä½ ç°åœ¨å·²ç»çŸ¥é“ç½‘ç»œåœ¨é¢„æµ‹å™ªå£°ï¼š

{{< math >}}
$
\varepsilon_\theta(x_t, t)
$
{{< /math >}}

æ ‡å‡†çš„ä¸€æ­¥å»å™ªå…¬å¼å°±æ˜¯ç›´æ¥æŠŠå™ªå£°â€œå‡æ‰â€ï¼š

{{< math >}}
$
\hat{x}_0(x_t)
=
\frac{1}{\sqrt{\bar{\alpha}_t}}
\left(
x_t
-
\sqrt{1 - \bar{\alpha}_t}\;
\varepsilon_\theta(x_t, t)
\right)
$
{{< /math >}}

ç›´è§‰ç†è§£ï¼š

- $ x_t $ï¼šç°åœ¨è¿™ä¸ªå¸¦å™ªçš„æ ·æœ¬  
- $ \varepsilon_\theta $ï¼šæ¨¡å‹è®¤ä¸ºâ€œè¿™é‡Œé¢æœ‰å¤šå°‘æ˜¯å™ªå£°â€  
- $ \hat{x}_0 $ï¼šåœ¨ç¬¬ $t$ æ­¥ï¼Œæ¨¡å‹å¿ƒä¸­â€œæœ€å¯èƒ½çš„å¹²å‡€æ ·æœ¬â€

> **é‡è¦å¼ºè°ƒï¼ˆé˜²æ­¢è¯¯è§£ï¼‰ï¼š**  
> $ \hat{x}_0 $ ä¸æ˜¯æœ€ç»ˆç”Ÿæˆç»“æœï¼Œ  
> å®ƒåªæ˜¯å½“å‰è¿™ä¸€æ­¥çš„â€œä¸´æ—¶ clean è§£é‡Šâ€ã€‚

---

# äºŒã€Guidance çš„æ ¸å¿ƒæ€æƒ³ï¼ˆä¸€å¥è¯ç‰ˆï¼‰

ç°åœ¨å‡è®¾ä½ æœ‰ä¸€ä¸ªç›®æ ‡å‡½æ•°ï¼ˆæˆ–æŸå¤±ï¼‰ï¼š

{{< math >}}
$
L(x_0) \quad \text{æˆ–} \quad R(x_0)
$
{{< /math >}}

ä¾‹å¦‚ï¼š

- å’Œç›®æ ‡å›¾åƒçš„è·ç¦»  
- æ˜¯å¦æ»¡è¶³æŸä¸ªçº¦æŸ  
- è½¨è¿¹ reward  
- classifier çš„ log-prob

**Guidance çš„æ€æƒ³åªæœ‰ä¸€å¥è¯ï¼š**

> æ—¢ç„¶æˆ‘å·²ç»èƒ½åœ¨æ¯ä¸€æ­¥å¾—åˆ°ä¸€ä¸ª $ \hat{x}_0 $ï¼Œ  
> é‚£æˆ‘å°±å¯ä»¥åœ¨â€œé‡‡æ ·è¿‡ç¨‹ä¸­â€  
> å¯¹è¿™ä¸ª $ \hat{x}_0 $ æ–½åŠ æ¢¯åº¦ä¿®æ­£ã€‚

---

# ä¸‰ã€æ¢¯åº¦æ˜¯æ€ä¹ˆçœŸæ­£â€œè¿› sample è¿‡ç¨‹â€çš„ï¼Ÿ

è¿™æ˜¯å…³é”®éƒ¨åˆ†ï¼Œåˆ†ä¸‰æ­¥ã€‚

---

## 1ï¸âƒ£ å…ˆåœ¨ clean space é‡Œç®—æ¢¯åº¦

å…ˆåœ¨å¹²å‡€ç©ºé—´è®¡ç®—æ¢¯åº¦ï¼š

{{< math >}}
$
g
=
\nabla_{\hat{x}_0}\, \big( - L(\hat{x}_0) \big)
$
{{< /math >}}

å¦‚æœæ˜¯ rewardï¼Œåˆ™æ˜¯ï¼š

{{< math >}}
$
\nabla_{\hat{x}_0}\, R(\hat{x}_0)
$
{{< /math >}}

**ç›´è§‰ï¼š**

è¿™ä¸ªæ¢¯åº¦å‘Šè¯‰ä½ ï¼š  
å¦‚æœæˆ‘æ˜¯ä¸€ä¸ªå¹²å‡€æ ·æœ¬ï¼Œå¾€å“ªé‡ŒåŠ¨èƒ½è®© loss å˜å° / reward å˜å¤§ã€‚

---

## 2ï¸âƒ£ æŠŠæ¢¯åº¦â€œä¼ å›â€åˆ°å½“å‰å™ªå£°å±‚

å…³é”®å…³ç³»æ˜¯ï¼š

{{< math >}}
$
\hat{x}_0
=
\frac{1}{\sqrt{\bar{\alpha}_t}} x_t
-
\frac{\sqrt{1-\bar{\alpha}_t}}{\sqrt{\bar{\alpha}_t}}
\varepsilon_\theta(x_t, t)
$
{{< /math >}}

å¯¹ $ x_t $ æ±‚å¯¼ï¼š

{{< math >}}
$
\frac{\partial \hat{x}_0}{\partial x_t}
=
\frac{1}{\sqrt{\bar{\alpha}_t}} I
$
{{< /math >}}

äºæ˜¯æ¢¯åº¦å›ä¼ éå¸¸ç®€å•ï¼š

{{< math >}}
$
\nabla_{x_t}\, \big( - L(\hat{x}_0) \big)
=
\frac{1}{\sqrt{\bar{\alpha}_t}}
\nabla_{\hat{x}_0}\, \big( - L(\hat{x}_0) \big)
$
{{< /math >}}

è¿™ä¸€æ­¥æœ¬è´¨ä¸Šæ˜¯åœ¨åšï¼š

> æŠŠ clean-space çš„åå¥½ï¼Œçº¿æ€§æ˜ å°„å›å½“å‰å™ªå£°å±‚ã€‚

---

## 3ï¸âƒ£ æŠŠ guidance æ¢¯åº¦åŠ è¿›åå‘é‡‡æ ·

æ ‡å‡†åå‘é‡‡æ ·ï¼ˆscore å½¢å¼ï¼Œå¿½ç•¥å¸¸æ•°ç»†èŠ‚ï¼‰ï¼š

{{< math >}}
$
x_{t-1}
\approx
\frac{1}{\alpha_t} x_t
+
\frac{\beta_t}{\alpha_t} \, s_\theta(x_t, t)
+
\sigma_t z
$
{{< /math >}}

å…¶ä¸­ï¼š

{{< math >}}
$
s_\theta(x_t, t) = \nabla_{x_t} \log p(x_t)
$
{{< /math >}}

åŠ å…¥ guidance åï¼š

{{< math >}}
$
x_{t-1}
\approx
\frac{1}{\alpha_t} x_t
+
\frac{\beta_t}{\alpha_t}
\left(
s_\theta(x_t, t)
+
\lambda \, \nabla_{x_t} ( - L(\hat{x}_0) )
\right)
+
\sigma_t z
$
{{< /math >}}

å…¶ä¸­ï¼š

- $ \lambda $ï¼šguidance strengthï¼ˆä¸»è¦è°ƒè¿™ä¸ªï¼‰

è§£é‡Šï¼š

- åŸæœ¬çš„ score é¡¹ï¼š  
  â†’ â€œåƒæ•°æ®åˆ†å¸ƒçš„æ–¹å‘â€
- æ–°åŠ çš„ guidance æ¢¯åº¦ï¼š  
  â†’ â€œæ›´ç¬¦åˆä»»åŠ¡ç›®æ ‡çš„æ–¹å‘â€

é‡‡æ ·æ—¶ä¸¤è‚¡åŠ›ä¸€èµ·æ‹‰ç€æ ·æœ¬å¾€å‰èµ°ã€‚

---

# ä¸€å¥è¯æ€»ç›´è§‰æ€»ç»“

1. æ¨¡å‹å‘Šè¯‰ä½ ï¼šç°åœ¨è¿™ä¸ª $x_t$ æœ€å¯èƒ½æ¥è‡ªå“ªä¸ª $\hat{x}_0$  
2. ä½ åœ¨ $\hat{x}_0$ ä¸Šè®¡ç®—ä»»åŠ¡æ¢¯åº¦  
3. é€šè¿‡çº¿æ€§å…³ç³»æŠŠæ¢¯åº¦ä¼ å› $x_t$  
4. åœ¨åå‘æ‰©æ•£æ—¶æŠŠè¿™ä¸ªæ–¹å‘åŠ è¿› drift

æ‰€ä»¥ guidance ä¸æ˜¯æ”¹è®­ç»ƒç›®æ ‡ï¼Œ  
è€Œæ˜¯**åœ¨é‡‡æ · ODE / SDE é‡Œç›´æ¥æ”¹é€Ÿåº¦åœºæ–¹å‘**ã€‚

# ä¸€ã€æœ€æ ¸å¿ƒçš„ä¸€æ¡å…¬å¼ï¼ˆä½ åªè¦æŠ“ä½å®ƒï¼‰

å‡è®¾ä½ åŸæœ¬æƒ³é‡‡æ ·çš„æ˜¯ç›®æ ‡åˆ†å¸ƒï¼š

{{< math >}}
$p(x)$
{{< /math >}}

ç°åœ¨ä½ å¼•å…¥ä¸€ä¸ªåå¥½ï¼ˆloss / reward / constraintï¼‰ï¼Œå®šä¹‰ä¸€ä¸ªæ–°ç›®æ ‡åˆ†å¸ƒï¼š

{{< math >}}
$p_{\text{guided}}(x) \propto p(x)\,\exp(\lambda R(x))$
{{< /math >}}

å…¶ä¸­ï¼š

- $R(x)$ï¼šrewardï¼ˆæˆ– $-L(x)$ï¼‰
- $\lambda$ï¼šå¼ºåº¦

è¿™æ˜¯ä¸€ä¸ªéå¸¸æ ‡å‡†çš„æ¦‚ç‡å»ºæ¨¡æ“ä½œï¼ˆèƒ½é‡æ¨¡å‹ã€è´å¶æ–¯åéªŒã€Boltzmann åˆ†å¸ƒï¼‰ã€‚

---

# äºŒã€è¿™ä¸€æ­¥ç›´æ¥ç»™å‡ºâ€œä¸ºä»€ä¹ˆæ¢¯åº¦èƒ½åŠ â€

å¯¹æ–°åˆ†å¸ƒå– logï¼Œå†å¯¹ $x$ æ±‚æ¢¯åº¦ï¼š

{{< math >}}
$\nabla_x \log p_{\text{guided}}(x)
= \nabla_x \log p(x)
+ \lambda \nabla_x R(x)$
{{< /math >}}

ä¹Ÿå°±æ˜¯ï¼š

- $\nabla_x \log p(x)$ï¼šåŸ score  
- $\lambda \nabla_x R(x)$ï¼šloss / reward æ¢¯åº¦

äºæ˜¯ç«‹åˆ»å¾—åˆ°ï¼š

{{< math >}}
$\text{new score} = \text{old score} + \lambda \nabla_x R(x)$
{{< /math >}}

è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæ¢¯åº¦å¯ä»¥**ç›´æ¥åŠ åœ¨ score ä¸Š**ã€‚  
ä¸æ˜¯ heuristicï¼Œè€Œæ˜¯**ç›®æ ‡åˆ†å¸ƒæ”¹å˜åçš„ç²¾ç¡®ç»“æœ**ã€‚

---

# ä¸‰ã€é‚£ diffusion çš„åå‘é‡‡æ ·åœ¨ç”¨ä»€ä¹ˆï¼Ÿ

åå‘é‡‡æ ·çš„ç»“æ„æœ¬è´¨æ˜¯ï¼š

> score å†³å®š drift + éšæœºå™ªå£°

ç°åœ¨æˆ‘ä»¬åªæ˜¯æŠŠï¼š

- åŸæ¥çš„ scoreï¼š$\nabla_x \log p(x_t)$

æ¢æˆäº†ï¼š

- æ–°ç›®æ ‡åˆ†å¸ƒçš„ scoreï¼š$\nabla_x \log p_{\text{guided}}(x_t)$

å› æ­¤åå‘ä¸€æ­¥çš„å½¢å¼è‡ªç„¶å˜æˆï¼ˆç¤ºæ„å†™æ³•ï¼‰ï¼š

{{< math >}}
$x_{t-1} \leftarrow x_t
+ \text{step}\cdot\big(s_\theta(x_t, t)
+ \lambda \nabla_{x_t} R(\hat{x}_0)\big)
+ \text{noise}$
{{< /math >}}

è¯­ä¹‰æ˜¯å®Œå…¨ä¸€è‡´çš„ï¼š

- $s_\theta(x_t,t)$ï¼šæ¨¡å‹ç»™å‡ºçš„åŸ score
- $\nabla R(\hat{x}_0)$ï¼šæŠŠåå¥½é€šè¿‡â€œå½“å‰ä¼°è®¡çš„ clean sampleâ€ä¼ å›åˆ° $x_t$ çš„å¼•å¯¼é¡¹

å› æ­¤ï¼š  
**ä¸æ˜¯åœ¨â€œä¹±æ”¹ä¸€æ­¥é‡‡æ ·â€ï¼Œè€Œæ˜¯åœ¨å¯¹æ–°çš„ç›®æ ‡åˆ†å¸ƒåšåˆæ³•çš„åå‘æ‰©æ•£ã€‚**

## Q1ï¼šä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘å¯ä»¥é€šè¿‡åŸºåˆ†å¸ƒ $p(x)$ï¼Œå†é€šè¿‡æŸäº›å¼•å¯¼ï¼ˆguidanceï¼‰ï¼Œç”Ÿæˆä¸€ä¸ªæ–°çš„åˆ†å¸ƒå—ï¼Ÿ

**Aï¼šæ˜¯çš„â€”â€”ä½†å¿…é¡»åŠ ä¸Šä¸€å¥éå¸¸å…³é”®çš„é™å®šï¼Œæ‰æ˜¯å®Œå…¨æ­£ç¡®çš„è¯´æ³•ã€‚**

### ä¸€å¥è¯çš„ç²¾ç¡®å®šå‹ç‰ˆ

{{< math >}}
$
æ˜¯çš„ï¼šä½ å¯ä»¥ä»ä¸€ä¸ªåŸºåˆ†å¸ƒ \; p(x) \; å‡ºå‘ï¼Œ  
é€šè¿‡åœ¨ç”Ÿæˆè¿‡ç¨‹ä¸­åŠ å…¥å¼•å¯¼ï¼ˆguidanceï¼‰ï¼Œ  
å¾—åˆ°ä¸€ä¸ªâ€œæ–°çš„ã€è¢«åç½®è¿‡çš„ç”Ÿæˆåˆ†å¸ƒâ€ã€‚  

ä½†è¿™ä¸ªæ–°åˆ†å¸ƒé€šå¸¸æ˜¯ï¼š  
è¢«å®šä¹‰åœ¨â€œç”Ÿæˆè¿‡ç¨‹ / è·¯å¾„â€ä¸Šçš„è¿‘ä¼¼åˆ†å¸ƒï¼Œ  
è€Œä¸ä¸€å®šç­‰ä»·äºä¸€ä¸ªäº‹å…ˆå†™å¥½çš„ã€ä¸¥æ ¼çš„é—­å¼åˆ†å¸ƒã€‚
$
{{< /math >}}

è¿™å¥è¯é‡Œï¼Œâ€œæ˜¯çš„â€æ˜¯çœŸçš„ï¼Œâ€œä½†â€ä¹ŸåŒæ ·é‡è¦ã€‚


## Q2ï¼šé‚£â€œé€šè¿‡å¼•å¯¼å¾—åˆ°æ–°åˆ†å¸ƒâ€åœ¨ç†è®ºä¸Šåˆ°åº•æœ‰å‡ ç§ä¸åŒå±‚çº§çš„å«ä¹‰ï¼Ÿ

**Aï¼šå¯ä»¥æ¸…æ¥šåœ°åˆ†æˆä¸‰ç§å±‚çº§ï¼Œä½ ç°åœ¨é—®çš„å…¶å®æ˜¯åœ¨è¿™ä¸‰è€…ä¹‹é—´åˆ‡æ¢ã€‚**


### âœ… æƒ…å½¢ Aï¼šä¸¥æ ¼æˆç«‹ï¼Œæœ‰ç†è®ºä¿è¯ï¼ˆç†æƒ³åŒ–æƒ…å½¢ï¼‰

è®¾å®šï¼š

- è¿ç»­æ—¶é—´  
- ä½¿ç”¨çœŸå® scoreï¼š  
  $\nabla \log p(x)$  
- reward ç›´æ¥ä½œç”¨åœ¨ $x$ ä¸Š  
- ç”¨ Langevin dynamics

åŠ¨åŠ›å­¦ä¸ºï¼š

{{< math >}}
$
dx = (\nabla \log p(x) + \lambda \nabla R(x)) dt + \sqrt{2}\, dW
$
{{< /math >}}

**ä¸¥æ ¼ç»“è®ºï¼š**

è¯¥éšæœºè¿‡ç¨‹çš„ä¸å˜åˆ†å¸ƒä¸ºï¼š

{{< math >}}
$
p_{\text{new}}(x) \propto p(x)\,\exp(\lambda R(x))
$
{{< /math >}}

åœ¨è¿™ä¸ªç†æƒ³è®¾å®šä¸‹ï¼š

> â€œæˆ‘å¯ä»¥é€šè¿‡ $p(x)$ï¼Œå†é€šè¿‡å¼•å¯¼ï¼Œç”Ÿæˆæ–°çš„åˆ†å¸ƒâ€

æ˜¯ **100% æ­£ç¡®çš„æ•™ç§‘ä¹¦ç»“è®º**ã€‚


### âš ï¸ æƒ…å½¢ Bï¼šçœŸå® diffusion / guided diffusion çš„æƒ…å†µ

ç°å®ä¸­å‘ç”Ÿäº†è¿™äº›å˜åŒ–ï¼š

- $p(x)$ ä¸æ˜¯ç›´æ¥å»ºæ¨¡ï¼Œè€Œæ˜¯é€šè¿‡å¤šå°ºåº¦ $p_t(x)$  
- score ç”±ç¥ç»ç½‘ç»œè¿‘ä¼¼  
- reward é€šå¸¸åœ¨å»å™ªä¼°è®¡  
  $\hat{x}_0(x_t)$  
  ä¸Šè®¡ç®—  
- ç¦»æ•£æ—¶é—´ã€æœ‰é™æ­¥æ•°

å› æ­¤æ›´å‡†ç¡®çš„è¯´æ³•æ˜¯ï¼š

> ä½ ä»ä¸€ä¸ªç”± $p(x)$ è¯±å¯¼å‡ºçš„ç”Ÿæˆè¿‡ç¨‹å‡ºå‘ï¼Œ  
> é€šè¿‡å¼•å¯¼ï¼Œå¾—åˆ°ä¸€ä¸ªæ–°çš„ç”Ÿæˆæœºåˆ¶ï¼Œ  
> å®ƒäº§ç”Ÿçš„æ ·æœ¬åˆ†å¸ƒè¢«ç³»ç»Ÿæ€§åœ°åå‘æŸä¸ªç›®æ ‡ã€‚

ä¹Ÿå°±æ˜¯è¯´ï¼š

- âœ” ä½ ç¡®å®ä¸å†é‡‡æ ·åŸå§‹çš„ $p(x)$  
- âœ˜ ä½†ä½ ä¸èƒ½ä¸¥æ ¼å†™æˆ  
  $x_0 \sim p(x)\exp(\lambda R(x))$

è¿™æ˜¯ **principled approximationï¼ˆæœ‰åŸåˆ™çš„è¿‘ä¼¼ï¼‰**ï¼Œ  
ä½†ä¸æ˜¯ä¸¥æ ¼åéªŒé‡‡æ ·å™¨ã€‚


### ğŸ§­ æƒ…å½¢ Cï¼šæ§åˆ¶ / æ¨æ–­è§†è§’ï¼ˆå®è·µä¸­æœ€ç¨³å¦¥çš„ç†è§£ï¼‰

åœ¨æ§åˆ¶ä¸æ¨æ–­é‡Œï¼Œæ›´çœŸå®çš„ç†è§£æ˜¯ï¼š

> ä½ ä¸æ˜¯â€œå…ˆå®šä¹‰ä¸€ä¸ªæ–°åˆ†å¸ƒå†å»é‡‡æ ·â€ï¼Œ  
> è€Œæ˜¯åœ¨ä¸€ä¸ªä»¥ $p(x)$ ä¸ºå…ˆéªŒçš„ç”Ÿæˆè¿‡ç¨‹ä¸­ï¼Œ  
> åœ¨çº¿æ–½åŠ åå¥½ï¼Œå¾—åˆ°è¢«å¼•å¯¼çš„è¾“å‡ºåˆ†å¸ƒã€‚

è¿™åœ¨æ•°å­¦ä¸Šæ›´æ¥è¿‘ï¼š

- KL-regularized inference  
- stochastic optimal control  
- path reweighting  

è€Œä¸æ˜¯â€œæ¢ä¸€ä¸ªé™æ€ pdfâ€ã€‚


## Q3ï¼šé‚£æˆ‘åˆ°åº•è¯¥æ€ä¹ˆä¸€å¥è¯æ€»ç»“ï¼Œæ‰ä¸ä¼šå†æ··ä¹±ï¼Ÿ

**Aï¼šä½ å¯ä»¥å®‰å…¨åœ°ä½¿ç”¨ä¸‹é¢è¿™å¥è¯ä½œä¸ºæœ€ç»ˆç»“è®ºã€‚**

{{< math >}}
$
æ˜¯çš„ï¼Œæˆ‘å¯ä»¥ä» \; p(x) \; å‡ºå‘ï¼Œé€šè¿‡å¼•å¯¼ï¼Œç”Ÿæˆä¸€ä¸ªæ–°çš„åˆ†å¸ƒï¼›  
åªæ˜¯è¿™ä¸ªâ€œæ–°åˆ†å¸ƒâ€çš„ä¸¥æ ¼å«ä¹‰ï¼Œ  
å–å†³äºæˆ‘æ˜¯åœ¨ç†æƒ³åŒ–çš„ Langevin æƒ…å½¢ä¸‹ï¼Œ  
è¿˜æ˜¯åœ¨å®é™…çš„ diffusion ç”Ÿæˆè¿‡ç¨‹ä¸­ã€‚
$
{{< /math >}}

åªè¦ä½ è®°ä½è¿™ä¸€ç‚¹ï¼š

- ä½ å°±ä¸ä¼šæŠŠ guided diffusion è¯¯å½“æˆâ€œç²¾ç¡®åéªŒé‡‡æ ·â€
- ä¹Ÿä¸ä¼šä½ä¼°å®ƒåœ¨ç”Ÿæˆä¸æ§åˆ¶ä¸­çš„ç†è®ºæ­£å½“æ€§

